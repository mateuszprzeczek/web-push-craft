/*! For license information please see webpush.js.LICENSE.txt */
var WebPushInit;(()=>{var e={73:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.initPush=d;var s=n(577),o=n(140),a=n(815),c=(0,s.initializeApp)({apiKey:"AIzaSyB7MMYUhj0dj_XSFhycKvLhanfCmpa86KY",authDomain:"web-push-craft.firebaseapp.com",projectId:"web-push-craft",storageBucket:"web-push-craft.firebasestorage.app",messagingSenderId:"160722961096",appId:"1:160722961096:web:6e67c169bbcf91489f5bfd"}),u=(0,o.getMessaging)(c),l=(0,a.getFirestore)(c),h=(0,a.getFirestore)(c);function d(){return r(this,void 0,void 0,function(){var e,t,n,r,s;return i(this,function(i){switch(i.label){case 0:c=document.querySelector('script[data-id="wb-craft"]'),e=(null==c?void 0:c.dataset.uuid)||"demo",i.label=1;case 1:return i.trys.push([1,8,,9]),[4,Notification.requestPermission()];case 2:return"granted"!==i.sent()?[2]:[4,navigator.serviceWorker.register("/firebase-messaging-sw.js")];case 3:return t=i.sent(),[4,navigator.serviceWorker.ready];case 4:return i.sent(),[4,(0,o.getToken)(u,{vapidKey:"BEbsGQfYDyf9EhFlEznPUA_DXDWLEyPDWhF4QM-mftgegicG88bWPcSmvVWUEiInQLwaUHzw24J8ffj8Yj6jr9Y",serviceWorkerRegistration:t})];case 5:return n=i.sent(),r=(0,a.doc)(h,"stats",e),[4,(0,a.setDoc)(r,{summary:{totalSubscriptions:(0,a.increment)(1),lastUpdated:(0,a.serverTimestamp)()}},{merge:!0})];case 6:return i.sent(),[4,(0,a.setDoc)((0,a.doc)(l,"users",e,"tokens",n),{token:n,createdAt:(new Date).toISOString(),userAgent:navigator.userAgent})];case 7:return i.sent(),console.log("Token zapisany do Firestore:",n),console.log("Subscription recorded for UUID:",e,"Token:",n),[3,9];case 8:return s=i.sent(),console.error("Push registration error:",s),[3,9];case 9:return[2]}var c})})}function f(e,t){return r(this,void 0,void 0,function(){var n,r,s,o,c;return i(this,function(i){switch(i.label){case 0:return e&&t?(n=(new Date).getDay(),r=(n+6)%7,s=(0,a.doc)(l,"stats",e),[4,(0,a.getDoc)(s)]):[2];case 1:return i.sent().exists()?((c={})["summary.total".concat((u=t,u.charAt(0).toUpperCase()+u.slice(1)))]=(0,a.increment)(1),c["".concat(t,".data.").concat(r)]=(0,a.increment)(1),o=c,[4,(0,a.updateDoc)(s,o)]):[2];case 2:return i.sent(),[2]}var u})})}(0,o.onMessage)(u,function(e){return r(void 0,void 0,void 0,function(){var t,n,s,o,a,c,u,l;return i(this,function(h){switch(h.label){case 0:return console.log("Web Push received in foreground:",e),(null==e?void 0:e.notification)&&(null==e?void 0:e.data)?(t=e.notification,n=t.title,s=t.body,o=t.icon,a=e.data,c=a.uuid,u=a.url||"/",l=new Notification(n||"test",{body:s,icon:o,data:a}),[4,f(c,"displays")]):[2];case 1:return h.sent(),l.onclick=function(){return r(void 0,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,f(c,"clicks")];case 1:return e.sent(),window.open(u,"_blank"),[2]}})})},[2]}})})}),d()},140:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(790);Object.keys(r).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},148:(e,t,n)=>{"use strict";n.r(t),n.d(t,{deleteDB:()=>m,openDB:()=>g,unwrap:()=>p,wrap:()=>f});const r=(e,t)=>t.some(t=>e instanceof t);let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),f(o.get(this))}:function(...e){return f(t.apply(p(this),e))}:function(e,...n){const r=t.call(p(this),e,...n);return c.set(r,e.sort?e.sort():[e]),f(r)}:(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});a.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e);var t}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(f(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&o.set(t,e)}).catch(()=>{}),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=d(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const p=e=>l.get(e);function g(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=f(o);return r&&o.addEventListener("upgradeneeded",e=>{r(f(o.result),e.oldVersion,e.newVersion,f(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}function m(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),f(n).then(()=>{})}const y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!y.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return w.set(t,s),s}var I;I=h,h={...I,get:(e,t,n)=>b(e,t)||I.get(e,t,n),has:(e,t)=>!!b(e,t)||I.has(e,t)}},199:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(319),i=n(844),s=n(336),o=n(148);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const c="@firebase/app",u="0.13.2",l=new i.Logger("@firebase/app"),h="@firebase/app-compat",d="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",g="@firebase/app-check",m="@firebase/auth",y="@firebase/auth-compat",v="@firebase/database",w="@firebase/data-connect",b="@firebase/database-compat",I="@firebase/functions",_="@firebase/functions-compat",E="@firebase/installations",T="@firebase/installations-compat",S="@firebase/messaging",C="@firebase/messaging-compat",D="@firebase/performance",A="@firebase/performance-compat",x="@firebase/remote-config",k="@firebase/remote-config-compat",N="@firebase/storage",O="@firebase/storage-compat",P="@firebase/firestore",L="@firebase/ai",M="@firebase/firestore-compat",R="firebase",F="[DEFAULT]",V={[c]:"fire-core",[h]:"fire-core-compat",[f]:"fire-analytics",[d]:"fire-analytics-compat",[g]:"fire-app-check",[p]:"fire-app-check-compat",[m]:"fire-auth",[y]:"fire-auth-compat",[v]:"fire-rtdb",[w]:"fire-data-connect",[b]:"fire-rtdb-compat",[I]:"fire-fn",[_]:"fire-fn-compat",[E]:"fire-iid",[T]:"fire-iid-compat",[S]:"fire-fcm",[C]:"fire-fcm-compat",[D]:"fire-perf",[A]:"fire-perf-compat",[x]:"fire-rc",[k]:"fire-rc-compat",[N]:"fire-gcs",[O]:"fire-gcs-compat",[P]:"fire-fst",[M]:"fire-fst-compat",[L]:"fire-vertex","fire-js":"fire-js",[R]:"fire-js-all"},j=new Map,B=new Map,U=new Map;function q(e,t){try{e.container.addComponent(t)}catch(n){l.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function z(e){const t=e.name;if(U.has(t))return l.debug(`There were multiple attempts to register component ${t}.`),!1;U.set(t,e);for(const t of j.values())q(t,e);for(const t of B.values())q(t,e);return!0}function $(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function K(e){return void 0!==e.options}const G=new s.ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class W{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw G.create("app-deleted",{appName:this._name})}}function H(e,t){const n=s.base64Decode(e.split(".")[1]);null!==n?void 0!==JSON.parse(n).exp?1e3*JSON.parse(n).exp-(new Date).getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`):console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`)}class Q extends W{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&H(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&H(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,Y(c,u,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){J(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw G.create("server-app-deleted")}}function X(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:F,automaticDataCollectionEnabled:!0},t),o=i.name;if("string"!=typeof o||!o)throw G.create("bad-app-name",{appName:String(o)});if(n||(n=s.getDefaultAppConfig()),!n)throw G.create("no-options");const a=j.get(o);if(a){if(s.deepEqual(n,a.options)&&s.deepEqual(i,a.config))return a;throw G.create("duplicate-app",{appName:o})}const c=new r.ComponentContainer(o);for(const e of U.values())c.addComponent(e);const u=new W(n,i,c);return j.set(o,u),u}async function J(e){let t=!1;const n=e.name;j.has(n)?(t=!0,j.delete(n)):B.has(n)&&e.decRefCount()<=0&&(B.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function Y(e,t,n){var i;let s=null!==(i=V[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void l.warn(e.join(" "))}z(new r.Component(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const Z="firebase-heartbeat-store";let ee=null;function te(){return ee||(ee=o.openDB("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Z)}catch(e){console.warn(e)}}}).catch(e=>{throw G.create("idb-open",{originalErrorMessage:e.message})})),ee}async function ne(e,t){try{const n=(await te()).transaction(Z,"readwrite"),r=n.objectStore(Z);await r.put(t,re(e)),await n.done}catch(e){if(e instanceof s.FirebaseError)l.warn(e.message);else{const t=G.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}function re(e){return`${e.name}!${e.options.appId}`}class ie{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oe(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=se();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){l.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=se(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ae(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ae(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return l.warn(e),""}}}function se(){return(new Date).toISOString().substring(0,10)}class oe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!s.isIndexedDBAvailable()&&s.validateIndexedDBOpenable().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await te()).transaction(Z),n=await t.objectStore(Z).get(re(e));return await t.done,n}catch(e){if(e instanceof s.FirebaseError)l.warn(e.message);else{const t=G.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ne(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ne(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ae(e){return s.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}z(new r.Component("platform-logger",e=>new a(e),"PRIVATE")),z(new r.Component("heartbeat",e=>new ie(e),"PRIVATE")),Y(c,u,"node"),Y(c,u,"cjs2017"),Y("fire-js",""),Object.defineProperty(t,"FirebaseError",{enumerable:!0,get:function(){return s.FirebaseError}}),t.SDK_VERSION="11.10.0",t._DEFAULT_ENTRY_NAME=F,t._addComponent=q,t._addOrOverwriteComponent=function(e,t){e.container.addOrOverwriteComponent(t)},t._apps=j,t._clearComponents=function(){U.clear()},t._components=U,t._getProvider=$,t._isFirebaseApp=K,t._isFirebaseServerApp=function(e){return null!=e&&void 0!==e.settings},t._registerComponent=z,t._removeServiceInstance=function(e,t,n=F){$(e,t).clearInstance(n)},t._serverApps=B,t.deleteApp=J,t.getApp=function(e=F){const t=j.get(e);if(!t&&e===F&&s.getDefaultAppConfig())return X();if(!t)throw G.create("no-app",{appName:e});return t},t.getApps=function(){return Array.from(j.values())},t.initializeApp=X,t.initializeServerApp=function(e,t){if(s.isBrowser()&&!s.isWebWorker())throw G.create("invalid-server-app-environment");let n;void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!0),n=K(e)?e.options:e;const i=Object.assign(Object.assign({},t),n);if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw G.create("finalization-registry-not-supported",{});const o=""+(a=JSON.stringify(i),[...a].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0));var a;const c=B.get(o);if(c)return c.incRefCount(t.releaseOnDeref),c;const u=new r.ComponentContainer(o);for(const e of U.values())u.addComponent(e);const l=new Q(n,t,o,u);return B.set(o,l),l},t.onLog=function(e,t){if(null!==e&&"function"!=typeof e)throw G.create("invalid-log-argument");i.setUserLogHandler(e,t)},t.registerVersion=Y,t.setLogLevel=function(e){i.setLogLevel(e)}},241:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(319),s=n(844),o=n(336),a=n(860),c=n(832);const u="@firebase/firestore",l="4.8.0";class h{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}h.UNAUTHENTICATED=new h(null),h.GOOGLE_CREDENTIALS=new h("google-credentials-uid"),h.FIRST_PARTY=new h("first-party-uid"),h.MOCK_USER=new h("mock-user");let d="11.10.0";const f=new s.Logger("@firebase/firestore");function p(){return f.logLevel}function g(e,...t){if(f.logLevel<=s.LogLevel.DEBUG){const n=t.map(v);f.debug(`Firestore (${d}): ${e}`,...n)}}function m(e,...t){if(f.logLevel<=s.LogLevel.ERROR){const n=t.map(v);f.error(`Firestore (${d}): ${e}`,...n)}}function y(e,...t){if(f.logLevel<=s.LogLevel.WARN){const n=t.map(v);f.warn(`Firestore (${d}): ${e}`,...n)}}function v(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function w(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,b(e,r,n)}function b(e,t,n){let r=`FIRESTORE (${d}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw m(r),new Error(r)}function I(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||b(t,i,r)}function _(e,t){return e}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class T extends o.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class S{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class C{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class D{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(h.UNAUTHENTICATED))}shutdown(){}}class A{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class x{constructor(e){this.t=e,this.currentUser=h.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){I(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new S;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new S,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{g("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(g("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new S)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(g("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(I("string"==typeof t.accessToken,31837,{l:t}),new C(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return I(null===e||"string"==typeof e,2055,{h:e}),new h(e)}}class k{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=h.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class N{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new k(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(h.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class O{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class P{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,r._isFirebaseServerApp(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){I(void 0===this.o,3512);const n=e=>{null!=e.error&&g("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,g("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{g("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):g("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new O(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(I("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new O(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function L(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function M(){return new TextEncoder}class R{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=L(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function F(e,t){return e<t?-1:e>t?1:0}function V(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return F(r,i);{const s=M(),o=B(s.encode(j(e,n)),s.encode(j(t,n)));return 0!==o?o:F(r,i)}}n+=r>65535?2:1}return F(e.length,t.length)}function j(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function B(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return F(e[n],t[n]);return F(e.length,t.length)}function U(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function q(e){return e+"\0"}const z="__name__";class ${constructor(e,t,n){void 0===t?t=0:t>e.length&&w(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&w(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===$.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=$.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return F(e.length,t.length)}static compareSegments(e,t){const n=$.isNumericId(e),r=$.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?$.extractNumericId(e).compare($.extractNumericId(t)):V(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.Integer.fromString(e.substring(4,e.length-2))}}class K extends ${construct(e,t,n){return new K(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new T(E.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new K(t)}static emptyPath(){return new K([])}}const G=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class W extends ${construct(e,t,n){return new W(e,t,n)}static isValidIdentifier(e){return G.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),W.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===z}static keyField(){return new W([z])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new T(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new T(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new T(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new T(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new W(t)}static emptyPath(){return new W([])}}class H{constructor(e){this.path=e}static fromPath(e){return new H(K.fromString(e))}static fromName(e){return new H(K.fromString(e).popFirst(5))}static empty(){return new H(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===K.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new K(e.slice()))}}function Q(e,t,n){if(!n)throw new T(E.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function X(e,t,n,r){if(!0===t&&!0===r)throw new T(E.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function J(e){if(!H.isDocumentKey(e))throw new T(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Y(e){if(H.isDocumentKey(e))throw new T(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Z(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ee(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":w(12329,{type:typeof e})}function te(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new T(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ee(e);throw new T(E.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function ne(e,t){if(t<=0)throw new T(E.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function re(e,t){const n={typeString:e};return t&&(n.value=t),n}function ie(e,t){if(!Z(e))throw new T(E.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new T(E.INVALID_ARGUMENT,n);return!0}const se=-62135596800,oe=1e6;class ae{static now(){return ae.fromMillis(Date.now())}static fromDate(e){return ae.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*oe);return new ae(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<se)throw new T(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oe}_compareTo(e){return this.seconds===e.seconds?F(this.nanoseconds,e.nanoseconds):F(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ae._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ie(e,ae._jsonSchema))return new ae(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-se;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ae._jsonSchemaVersion="firestore/timestamp/1.0",ae._jsonSchema={type:re("string",ae._jsonSchemaVersion),seconds:re("number"),nanoseconds:re("number")};class ce{static fromTimestamp(e){return new ce(e)}static min(){return new ce(new ae(0,0))}static max(){return new ce(new ae(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ue=-1;class le{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function he(e){return e.fields.find(e=>2===e.kind)}function de(e){return e.fields.filter(e=>2!==e.kind)}function fe(e,t){let n=F(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(n=ge(e.fields[r],t.fields[r]),0!==n)return n;return F(e.fields.length,t.fields.length)}le.UNKNOWN_ID=-1;class pe{constructor(e,t){this.fieldPath=e,this.kind=t}}function ge(e,t){const n=W.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:F(e.kind,t.kind)}class me{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new me(0,we.min())}}function ye(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ce.fromTimestamp(1e9===r?new ae(n+1,0):new ae(n,r));return new we(i,H.empty(),t)}function ve(e){return new we(e.readTime,e.key,ue)}class we{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new we(ce.min(),H.empty(),ue)}static max(){return new we(ce.max(),H.empty(),ue)}}function be(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=H.comparator(e.documentKey,t.documentKey),0!==n?n:F(e.largestBatchId,t.largestBatchId))}const Ie="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Ee(e){if(e.code!==E.FAILED_PRECONDITION||e.message!==Ie)throw e;g("LocalStore","Unexpectedly lost primary lease")}class Te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&w(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Te((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Te?t:Te.resolve(t)}catch(e){return Te.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Te.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Te.reject(t)}static resolve(e){return new Te((t,n)=>{t(e)})}static reject(e){return new Te((t,n)=>{n(e)})}static waitFor(e){return new Te((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Te.resolve(!1);for(const n of e)t=t.next(e=>e?Te.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Te((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next(e=>{s[c]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new Te((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}const Se="SimpleDb";class Ce{static open(e,t,n,r){try{return new Ce(t,e.transaction(r,n))}catch(e){throw new ke(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new S,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ke(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=Me(t.target.error);this.S.reject(new ke(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(g(Se,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Oe(t)}}class De{static delete(e){return g(Se,"Removing database:",e),Pe(o.getGlobal().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!o.isIndexedDBAvailable())return!1;if(De.F())return!0;const e=o.getUA(),t=De.M(e),n=0<t&&t<10,r=Ae(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===De.M(o.getUA())&&m("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(g(Se,"Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ke(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new T(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new T(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ke(e,r))},r.onupgradeneeded=e=>{g(Se,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,r.transaction,e.oldVersion,this.version).next(()=>{g(Se,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{const t=e.target;this.L=t.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var t;null===e.newVersion&&(y('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null===(t=this.databaseDeletedListener)||void 0===t||t.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.k(e);const t=Ce.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),Te.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(g(Se,"Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Ae(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class xe{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return Pe(this.$.delete())}}class ke extends T{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ne(e){return"IndexedDbTransactionError"===e.name}class Oe{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(g(Se,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(g(Se,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Pe(n)}add(e){return g(Se,"ADD",this.store.name,e,e),Pe(this.store.add(e))}get(e){return Pe(this.store.get(e)).next(t=>(void 0===t&&(t=null),g(Se,"GET",this.store.name,e,t),t))}delete(e){return g(Se,"DELETE",this.store.name,e),Pe(this.store.delete(e))}count(){return g(Se,"COUNT",this.store.name),Pe(this.store.count())}j(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Te((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(n),t=[];return this.J(e,(e,n)=>{t.push(n)}).next(()=>t)}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Te((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Y(e,t){g(Se,"DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;const r=this.cursor(n);return this.J(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.J(r,t)}ee(e){const t=this.cursor({});return new Te((n,r)=>{t.onerror=e=>{const t=Me(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}J(e,t){const n=[];return new Te((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new xe(i),o=t(i.primaryKey,i.value,s);if(o instanceof Te){const e=o.catch(e=>(s.done(),Te.reject(e)));n.push(e)}s.isDone?r():null===s.W?i.continue():i.continue(s.W)}}).next(()=>Te.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pe(e){return new Te((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Me(e.target.error);n(t)}})}let Le=!1;function Me(e){const t=De.M(o.getUA());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Le||(Le=!0,setTimeout(()=>{throw e},0)),e}}return e}const Re="IndexBackfiller";class Fe{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ne(e){g(Re,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const e=await this.te.re();g(Re,`Documents written: ${e}`)}catch(e){Ne(e)?g(Re,"Ignoring IndexedDB error during index backfill: ",e):await Ee(e)}await this.ne(6e4)})}}class Ve{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){const n=new Set;let r=t,i=!0;return Te.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return g(Re,`Processing collection: ${t}`),this.se(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}se(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.oe(r,n)).next(n=>(g(Re,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}oe(e,t){let n=e;return t.changes.forEach((e,t)=>{const r=ve(t);be(r,n)>0&&(n=r)}),new we(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class je{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}je.ue=-1;const Be=-1;function Ue(e){return null==e}function qe(e){return 0===e&&1/e==-1/0}function ze(e){return"number"==typeof e&&Number.isInteger(e)&&!qe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const $e="";function Ke(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=We(t)),t=Ge(e.get(n),t);return We(t)}function Ge(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case $e:n+="";break;default:n+=r}}return n}function We(e){return e+$e+""}function He(e){const t=e.length;if(I(t>=2,64408,{path:e}),2===t)return I(e.charAt(0)===$e&&""===e.charAt(1),56145,{path:e}),K.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf($e,s);switch((t<0||t>n)&&w(50515,{path:e}),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:w(61167,{path:e})}s=t+2}return new K(r)}const Qe="remoteDocuments",Xe="owner",Je="owner",Ye="mutationQueues",Ze="mutations",et="batchId",tt="userMutationsIndex",nt=["userId","batchId"];function rt(e,t){return[e,Ke(t)]}function it(e,t,n){return[e,Ke(t),n]}const st={},ot="documentMutations",at="remoteDocumentsV14",ct=["prefixPath","collectionGroup","readTime","documentId"],ut="documentKeyIndex",lt=["prefixPath","collectionGroup","documentId"],ht="collectionGroupIndex",dt=["collectionGroup","readTime","prefixPath","documentId"],ft="remoteDocumentGlobal",pt="remoteDocumentGlobalKey",gt="targets",mt="queryTargetsIndex",yt=["canonicalId","targetId"],vt="targetDocuments",wt=["targetId","path"],bt="documentTargetsIndex",It=["path","targetId"],_t="targetGlobalKey",Et="targetGlobal",Tt="collectionParents",St=["collectionId","parent"],Ct="clientMetadata",Dt="bundles",At="namedQueries",xt="indexConfiguration",kt="collectionGroupIndex",Nt="indexState",Ot=["indexId","uid"],Pt="sequenceNumberIndex",Lt=["uid","sequenceNumber"],Mt="indexEntries",Rt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ft="documentKeyIndex",Vt=["indexId","uid","orderedDocumentKey"],jt="documentOverlays",Bt=["userId","collectionPath","documentId"],Ut="collectionPathOverlayIndex",qt=["userId","collectionPath","largestBatchId"],zt="collectionGroupOverlayIndex",$t=["userId","collectionGroup","largestBatchId"],Kt="globals",Gt=[Ye,Ze,ot,Qe,gt,Xe,Et,vt,Ct,ft,Tt,Dt,At],Wt=[...Gt,jt],Ht=[Ye,Ze,ot,at,gt,Xe,Et,vt,Ct,ft,Tt,Dt,At,jt],Qt=Ht,Xt=[...Qt,xt,Nt,Mt],Jt=Xt,Yt=[...Xt,Kt],Zt=Yt;class en extends _e{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function tn(e,t){const n=_(e);return De.N(n.ce,t)}function nn(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function rn(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function sn(e,t){const n=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function on(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class an{constructor(e,t){this.comparator=e,this.root=t||un.EMPTY}insert(e,t){return new an(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,un.BLACK,null,null))}remove(e){return new an(this.comparator,this.root.remove(e,this.comparator).copy(null,null,un.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cn(this.root,e,this.comparator,!1)}getReverseIterator(){return new cn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cn(this.root,e,this.comparator,!0)}}class cn{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class un{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:un.RED,this.left=null!=r?r:un.EMPTY,this.right=null!=i?i:un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new un(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return un.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw w(43730,{key:this.key,value:this.value});if(this.right.isRed())throw w(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw w(27949);return e+(this.isRed()?0:1)}}un.EMPTY=null,un.RED=!0,un.BLACK=!1,un.EMPTY=new class{constructor(){this.size=0}get key(){throw w(57766)}get value(){throw w(16141)}get color(){throw w(16727)}get left(){throw w(29726)}get right(){throw w(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new un(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ln{constructor(e){this.comparator=e,this.data=new an(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hn(this.data.getIterator())}getIteratorFrom(e){return new hn(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ln))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ln(this.comparator);return t.data=e,t}}class hn{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function dn(e){return e.hasNext()?e.getNext():void 0}class fn{constructor(e){this.fields=e,e.sort(W.comparator)}static empty(){return new fn([])}unionWith(e){let t=new ln(W.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new fn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return U(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class pn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new pn("Invalid base64 string: "+e):e}}(e);return new gn(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new gn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return F(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gn.EMPTY_BYTE_STRING=new gn("");const mn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yn(e){if(I(!!e,39018),"string"==typeof e){let t=0;const n=mn.exec(e);if(I(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:vn(e.seconds),nanos:vn(e.nanos)}}function vn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function wn(e){return"string"==typeof e?gn.fromBase64String(e):gn.fromUint8Array(e)}const bn="server_timestamp",In="__type__",_n="__previous_value__",En="__local_write_time__";function Tn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[In])||void 0===n?void 0:n.stringValue)===bn}function Sn(e){const t=e.mapValue.fields[_n];return Tn(t)?Sn(t):t}function Cn(e){const t=yn(e.mapValue.fields[En].timestampValue);return new ae(t.seconds,t.nanos)}class Dn{constructor(e,t,n,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const An="(default)";class xn{constructor(e,t){this.projectId=e,this.database=t||An}static empty(){return new xn("","")}get isDefaultDatabase(){return this.database===An}isEqual(e){return e instanceof xn&&e.projectId===this.projectId&&e.database===this.database}}const kn="__type__",Nn="__max__",On={mapValue:{fields:{__type__:{stringValue:Nn}}}},Pn="__vector__",Ln="value",Mn={nullValue:"NULL_VALUE"};function Rn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Tn(e)?4:Zn(e)?9007199254740991:Jn(e)?10:11:w(28295,{value:e})}function Fn(e,t){if(e===t)return!0;const n=Rn(e);if(n!==Rn(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Cn(e).isEqual(Cn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=yn(e.timestampValue),r=yn(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return wn(e.bytesValue).isEqual(wn(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return vn(e.geoPointValue.latitude)===vn(t.geoPointValue.latitude)&&vn(e.geoPointValue.longitude)===vn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return vn(e.integerValue)===vn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=vn(e.doubleValue),r=vn(t.doubleValue);return n===r?qe(n)===qe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return U(e.arrayValue.values||[],t.arrayValue.values||[],Fn);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(nn(n)!==nn(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Fn(n[e],r[e])))return!1;return!0}(e,t);default:return w(52216,{left:e})}}function Vn(e,t){return void 0!==(e.values||[]).find(e=>Fn(e,t))}function jn(e,t){if(e===t)return 0;const n=Rn(e),r=Rn(t);if(n!==r)return F(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return F(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=vn(e.integerValue||e.doubleValue),r=vn(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Bn(e.timestampValue,t.timestampValue);case 4:return Bn(Cn(e),Cn(t));case 5:return V(e.stringValue,t.stringValue);case 6:return function(e,t){const n=wn(e),r=wn(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=F(n[e],r[e]);if(0!==t)return t}return F(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=F(vn(e.latitude),vn(t.latitude));return 0!==n?n:F(vn(e.longitude),vn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Un(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Ln])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Ln])||void 0===r?void 0:r.arrayValue,l=F((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:Un(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===On.mapValue&&t===On.mapValue)return 0;if(e===On.mapValue)return 1;if(t===On.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=V(r[e],s[e]);if(0!==t)return t;const o=jn(n[r[e]],i[s[e]]);if(0!==o)return o}return F(r.length,s.length)}(e.mapValue,t.mapValue);default:throw w(23264,{le:n})}}function Bn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return F(e,t);const n=yn(e),r=yn(t),i=F(n.seconds,r.seconds);return 0!==i?i:F(n.nanos,r.nanos)}function Un(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=jn(n[e],r[e]);if(t)return t}return F(n.length,r.length)}function qn(e){return zn(e)}function zn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=yn(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return wn(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return H.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=zn(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${zn(e.fields[i])}`;return n+"}"}(e.mapValue):w(61005,{value:e})}function $n(e){switch(Rn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Sn(e);return t?16+$n(t):16;case 5:return 2*e.stringValue.length;case 6:return wn(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+$n(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return rn(e.fields,(e,n)=>{t+=e.length+$n(n)}),t}(e.mapValue);default:throw w(13486,{value:e})}}function Kn(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Gn(e){return!!e&&"integerValue"in e}function Wn(e){return!!e&&"arrayValue"in e}function Hn(e){return!!e&&"nullValue"in e}function Qn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Xn(e){return!!e&&"mapValue"in e}function Jn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[kn])||void 0===n?void 0:n.stringValue)===Pn}function Yn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return rn(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Yn(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Yn(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Zn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Nn}const er={mapValue:{fields:{[kn]:{stringValue:Pn},[Ln]:{arrayValue:{}}}}};function tr(e){return"nullValue"in e?Mn:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Kn(xn.empty(),H.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Jn(e)?er:{mapValue:{}}:w(35942,{value:e})}function nr(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Kn(xn.empty(),H.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?er:"mapValue"in e?Jn(e)?{mapValue:{}}:On:w(61959,{value:e})}function rr(e,t){const n=jn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function ir(e,t){const n=jn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class sr{constructor(e){this.value=e}static empty(){return new sr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yn(t)}setAll(e){let t=W.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Yn(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Xn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Xn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){rn(t,(t,n)=>e[t]=n);for(const t of n)delete e[t]}clone(){return new sr(Yn(this.value))}}function or(e){const t=[];return rn(e.fields,(e,n)=>{const r=new W([e]);if(Xn(n)){const e=or(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new fn(t)}class ar{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ar(e,0,ce.min(),ce.min(),ce.min(),sr.empty(),0)}static newFoundDocument(e,t,n,r){return new ar(e,1,t,ce.min(),n,r,0)}static newNoDocument(e,t){return new ar(e,2,t,ce.min(),ce.min(),sr.empty(),0)}static newUnknownDocument(e,t){return new ar(e,3,t,ce.min(),ce.min(),sr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ce.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ar&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ar(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class cr{constructor(e,t){this.position=e,this.inclusive=t}}function ur(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?H.comparator(H.fromName(o.referenceValue),n.key):jn(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function lr(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Fn(e.position[n],t.position[n]))return!1;return!0}class hr{constructor(e,t="asc"){this.field=e,this.dir=t}}function dr(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class fr{}class pr extends fr{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Tr(e,t,n):"array-contains"===t?new Ar(e,n):"in"===t?new xr(e,n):"not-in"===t?new kr(e,n):"array-contains-any"===t?new Nr(e,n):new pr(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Sr(e,n):new Cr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(jn(t,this.value)):null!==t&&Rn(this.value)===Rn(t)&&this.matchesComparison(jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return w(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class gr extends fr{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new gr(e,t)}matches(e){return mr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function mr(e){return"and"===e.op}function yr(e){return"or"===e.op}function vr(e){return wr(e)&&mr(e)}function wr(e){for(const t of e.filters)if(t instanceof gr)return!1;return!0}function br(e){if(e instanceof pr)return e.field.canonicalString()+e.op.toString()+qn(e.value);if(vr(e))return e.filters.map(e=>br(e)).join(",");{const t=e.filters.map(e=>br(e)).join(",");return`${e.op}(${t})`}}function Ir(e,t){return e instanceof pr?function(e,t){return t instanceof pr&&e.op===t.op&&e.field.isEqual(t.field)&&Fn(e.value,t.value)}(e,t):e instanceof gr?function(e,t){return t instanceof gr&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Ir(n,t.filters[r]),!0)}(e,t):void w(19439)}function _r(e,t){const n=e.filters.concat(t);return gr.create(n,e.op)}function Er(e){return e instanceof pr?function(e){return`${e.field.canonicalString()} ${e.op} ${qn(e.value)}`}(e):e instanceof gr?function(e){return e.op.toString()+" {"+e.getFilters().map(Er).join(" ,")+"}"}(e):"Filter"}class Tr extends pr{constructor(e,t,n){super(e,t,n),this.key=H.fromName(n.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class Sr extends pr{constructor(e,t){super(e,"in",t),this.keys=Dr(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Cr extends pr{constructor(e,t){super(e,"not-in",t),this.keys=Dr(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Dr(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>H.fromName(e.referenceValue))}class Ar extends pr{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Wn(t)&&Vn(t.arrayValue,this.value)}}class xr extends pr{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Vn(this.value.arrayValue,t)}}class kr extends pr{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Vn(this.value.arrayValue,t)}}class Nr extends pr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Wn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Vn(this.value.arrayValue,e))}}class Or{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Pe=null}}function Pr(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Or(e,t,n,r,i,s,o)}function Lr(e){const t=_(e);if(null===t.Pe){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>br(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ue(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>qn(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>qn(e)).join(",")),t.Pe=e}return t.Pe}function Mr(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!dr(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ir(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!lr(e.startAt,t.startAt)&&lr(e.endAt,t.endAt)}function Rr(e){return H.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Fr(e,t){return e.filters.filter(e=>e instanceof pr&&e.field.isEqual(t))}function Vr(e,t,n){let r=Mn,i=!0;for(const n of Fr(e,t)){let e=Mn,t=!0;switch(n.op){case"<":case"<=":e=tr(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Mn}rr({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];rr({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function jr(e,t,n){let r=On,i=!0;for(const n of Fr(e,t)){let e=On,t=!0;switch(n.op){case">=":case">":e=nr(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=On}ir({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];ir({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Br{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function Ur(e,t,n,r,i,s,o,a){return new Br(e,t,n,r,i,s,o,a)}function qr(e){return new Br(e)}function zr(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function $r(e){return null!==e.collectionGroup}function Kr(e){const t=_(e);if(null===t.Te){t.Te=[];const e=new Set;for(const n of t.explicitOrderBy)t.Te.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new ln(W.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Te.push(new hr(r,n))}),e.has(W.keyField().canonicalString())||t.Te.push(new hr(W.keyField(),n))}return t.Te}function Gr(e){const t=_(e);return t.Ie||(t.Ie=Hr(t,Kr(e))),t.Ie}function Wr(e){const t=_(e);return t.de||(t.de=Hr(t,e.explicitOrderBy)),t.de}function Hr(e,t){if("F"===e.limitType)return Pr(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new hr(e.field,t)});const n=e.endAt?new cr(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new cr(e.startAt.position,e.startAt.inclusive):null;return Pr(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Qr(e,t){const n=e.filters.concat([t]);return new Br(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Xr(e,t,n){return new Br(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Jr(e,t){return Mr(Gr(e),Gr(t))&&e.limitType===t.limitType}function Yr(e){return`${Lr(Gr(e))}|lt:${e.limitType}`}function Zr(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Er(e)).join(", ")}]`),Ue(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>qn(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>qn(e)).join(",")),`Target(${t})`}(Gr(e))}; limitType=${e.limitType})`}function ei(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):H.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Kr(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ur(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Kr(e),t)||e.endAt&&!function(e,t,n){const r=ur(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Kr(e),t))}(e,t)}function ti(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ni(e){return(t,n)=>{let r=!1;for(const i of Kr(e)){const e=ri(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function ri(e,t,n){const r=e.field.isKeyField()?H.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?jn(r,i):w(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return w(19790,{direction:e.dir})}}class ii{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){rn(this.inner,(t,n)=>{for(const[t,r]of n)e(t,r)})}isEmpty(){return on(this.inner)}size(){return this.innerSize}}const si=new an(H.comparator);function oi(){return si}const ai=new an(H.comparator);function ci(...e){let t=ai;for(const n of e)t=t.insert(n.key,n);return t}function ui(e){let t=ai;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function li(){return di()}function hi(){return di()}function di(){return new ii(e=>e.toString(),(e,t)=>e.isEqual(t))}const fi=new an(H.comparator),pi=new ln(H.comparator);function gi(...e){let t=pi;for(const n of e)t=t.add(n);return t}const mi=new ln(F);function yi(){return mi}function vi(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qe(t)?"-0":t}}function wi(e){return{integerValue:""+e}}function bi(e,t){return ze(t)?wi(t):vi(e,t)}class Ii{constructor(){this._=void 0}}function _i(e,t,n){return e instanceof Si?function(e,t){const n={fields:{[In]:{stringValue:bn},[En]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Tn(t)&&(t=Sn(t)),t&&(n.fields[_n]=t),{mapValue:n}}(n,t):e instanceof Ci?Di(e,t):e instanceof Ai?xi(e,t):function(e,t){const n=Ti(e,t),r=Ni(n)+Ni(e.Ee);return Gn(n)&&Gn(e.Ee)?wi(r):vi(e.serializer,r)}(e,t)}function Ei(e,t,n){return e instanceof Ci?Di(e,t):e instanceof Ai?xi(e,t):n}function Ti(e,t){return e instanceof ki?function(e){return Gn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Si extends Ii{}class Ci extends Ii{constructor(e){super(),this.elements=e}}function Di(e,t){const n=Oi(t);for(const t of e.elements)n.some(e=>Fn(e,t))||n.push(t);return{arrayValue:{values:n}}}class Ai extends Ii{constructor(e){super(),this.elements=e}}function xi(e,t){let n=Oi(t);for(const t of e.elements)n=n.filter(e=>!Fn(e,t));return{arrayValue:{values:n}}}class ki extends Ii{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Ni(e){return vn(e.integerValue||e.doubleValue)}function Oi(e){return Wn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Pi{constructor(e,t){this.field=e,this.transform=t}}class Li{constructor(e,t){this.version=e,this.transformResults=t}}class Mi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mi}static exists(e){return new Mi(void 0,e)}static updateTime(e){return new Mi(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ri(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Fi{}function Vi(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Hi(e.key,Mi.none()):new zi(e.key,e.data,Mi.none());{const n=e.data,r=sr.empty();let i=new ln(W.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new $i(e.key,r,new fn(i.toArray()),Mi.none())}}function ji(e,t,n){e instanceof zi?function(e,t,n){const r=e.value.clone(),i=Gi(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof $i?function(e,t,n){if(!Ri(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Gi(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ki(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Bi(e,t,n,r){return e instanceof zi?function(e,t,n,r){if(!Ri(e.precondition,t))return n;const i=e.value.clone(),s=Wi(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof $i?function(e,t,n,r){if(!Ri(e.precondition,t))return n;const i=Wi(e.fieldTransforms,r,t),s=t.data;return s.setAll(Ki(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Ri(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Ui(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Ti(r.transform,e||null);null!=i&&(null===n&&(n=sr.empty()),n.set(r.field,i))}return n||null}function qi(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&U(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ci&&t instanceof Ci||e instanceof Ai&&t instanceof Ai?U(e.elements,t.elements,Fn):e instanceof ki&&t instanceof ki?Fn(e.Ee,t.Ee):e instanceof Si&&t instanceof Si}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class zi extends Fi{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class $i extends Fi{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ki(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Gi(e,t,n){const r=new Map;I(e.length===n.length,32656,{Ae:n.length,Re:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Ei(o,a,n[i]))}return r}function Wi(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,_i(e,s,t))}return r}class Hi extends Fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qi extends Fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Xi{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&ji(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Bi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Bi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=hi();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Vi(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ce.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),gi())}isEqual(e){return this.batchId===e.batchId&&U(this.mutations,e.mutations,(e,t)=>qi(e,t))&&U(this.baseMutations,e.baseMutations,(e,t)=>qi(e,t))}}class Ji{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){I(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let r=fi;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Ji(e,t,n,r)}}class Yi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Zi{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class es{constructor(e,t){this.count=e,this.unchangedNames=t}}var ts,ns;function rs(e){switch(e){case E.OK:return w(64938);case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0;default:return w(15467,{code:e})}}function is(e){if(void 0===e)return m("GRPC error has no .code"),E.UNKNOWN;switch(e){case ts.OK:return E.OK;case ts.CANCELLED:return E.CANCELLED;case ts.UNKNOWN:return E.UNKNOWN;case ts.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case ts.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case ts.INTERNAL:return E.INTERNAL;case ts.UNAVAILABLE:return E.UNAVAILABLE;case ts.UNAUTHENTICATED:return E.UNAUTHENTICATED;case ts.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case ts.NOT_FOUND:return E.NOT_FOUND;case ts.ALREADY_EXISTS:return E.ALREADY_EXISTS;case ts.PERMISSION_DENIED:return E.PERMISSION_DENIED;case ts.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case ts.ABORTED:return E.ABORTED;case ts.OUT_OF_RANGE:return E.OUT_OF_RANGE;case ts.UNIMPLEMENTED:return E.UNIMPLEMENTED;case ts.DATA_LOSS:return E.DATA_LOSS;default:return w(39323,{code:e})}}(ns=ts||(ts={}))[ns.OK=0]="OK",ns[ns.CANCELLED=1]="CANCELLED",ns[ns.UNKNOWN=2]="UNKNOWN",ns[ns.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ns[ns.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ns[ns.NOT_FOUND=5]="NOT_FOUND",ns[ns.ALREADY_EXISTS=6]="ALREADY_EXISTS",ns[ns.PERMISSION_DENIED=7]="PERMISSION_DENIED",ns[ns.UNAUTHENTICATED=16]="UNAUTHENTICATED",ns[ns.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ns[ns.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ns[ns.ABORTED=10]="ABORTED",ns[ns.OUT_OF_RANGE=11]="OUT_OF_RANGE",ns[ns.UNIMPLEMENTED=12]="UNIMPLEMENTED",ns[ns.INTERNAL=13]="INTERNAL",ns[ns.UNAVAILABLE=14]="UNAVAILABLE",ns[ns.DATA_LOSS=15]="DATA_LOSS";let ss=null;const os=new a.Integer([4294967295,4294967295],0);function as(e){const t=M().encode(e),n=new a.Md5;return n.update(t),new Uint8Array(n.digest())}function cs(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a.Integer([n,r],0),new a.Integer([i,s],0)]}class us{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ls(`Invalid padding: ${t}`);if(n<0)throw new ls(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new ls(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ls(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=a.Integer.fromNumber(this.fe)}pe(e,t,n){let r=e.add(t.multiply(a.Integer.fromNumber(n)));return 1===r.compare(os)&&(r=new a.Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=as(e),[n,r]=cs(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(n,r,e);if(!this.ye(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new us(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.fe)return;const t=as(e),[n,r]=cs(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(n,r,e);this.we(t)}}we(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ls extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class hs{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ds.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new hs(ce.min(),r,new an(F),oi(),gi())}}class ds{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ds(n,t,gi(),gi(),gi())}}class fs{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=r}}class ps{constructor(e,t){this.targetId=e,this.De=t}}class gs{constructor(e,t,n=gn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ms{constructor(){this.ve=0,this.Ce=ws(),this.Fe=gn.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=gi(),t=gi(),n=gi();return this.Ce.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:w(38017,{changeType:i})}}),new ds(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=ws()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,I(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class ys{constructor(e){this.We=e,this.Ge=new Map,this.ze=oi(),this.je=vs(),this.Je=vs(),this.He=new an(F)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:w(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,n)=>{this.nt(n)&&t(n)})}it(e){const t=e.targetId,n=e.De.count,r=this.st(t);if(r){const i=r.target;if(Rr(i))if(0===n){const e=new H(i.path);this.Xe(t,e,ar.newNoDocument(e,ce.min()))}else I(1===n,20013,{expectedCount:n});else{const r=this.ot(t);if(r!==n){const n=this._t(e),i=n?this.ut(n,e,r):1;if(0!==i){this.rt(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e)}null==ss||ss.ct(function(e,t,n,r,i){var s,o,a,c,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.De,this.We.lt(),n,i))}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=wn(n).toUint8Array()}catch(e){if(e instanceof pn)return y("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new us(s,r,i)}catch(e){return y(e instanceof ls?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.fe?null:o}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){const n=this.We.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.We.lt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Xe(t,n,null),r++)}),r}Pt(e){const t=new Map;this.Ge.forEach((n,r)=>{const i=this.st(r);if(i){if(n.current&&Rr(i.target)){const t=new H(i.target.path);this.Tt(t).has(r)||this.It(r,t)||this.Xe(r,t,ar.newNoDocument(t,e))}n.Ne&&(t.set(r,n.Le()),n.ke())}});let n=gi();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ze.forEach((t,n)=>n.setReadTime(e));const r=new hs(e,t,this.He,this.ze,n);return this.ze=oi(),this.je=vs(),this.Je=vs(),this.He=new an(F),r}Ze(e,t){if(!this.nt(e))return;const n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;const r=this.tt(e);this.It(e,t)?r.qe(t,1):r.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new ms,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new ln(F),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new ln(F),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||g("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new ms),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function vs(){return new an(H.comparator)}function ws(){return new an(H.comparator)}const bs={asc:"ASCENDING",desc:"DESCENDING"},Is={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_s={and:"AND",or:"OR"};class Es{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ts(e,t){return e.useProto3Json||Ue(t)?t:{value:t}}function Ss(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Cs(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ds(e,t){return Ss(e,t.toTimestamp())}function As(e){return I(!!e,49232),ce.fromTimestamp(function(e){const t=yn(e);return new ae(t.seconds,t.nanos)}(e))}function xs(e,t){return ks(e,t).canonicalString()}function ks(e,t){const n=function(e){return new K(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ns(e){const t=K.fromString(e);return I(eo(t),10190,{key:t.toString()}),t}function Os(e,t){return xs(e.databaseId,t.path)}function Ps(e,t){const n=Ns(t);if(n.get(1)!==e.databaseId.projectId)throw new T(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new T(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new H(Fs(n))}function Ls(e,t){return xs(e.databaseId,t)}function Ms(e){const t=Ns(e);return 4===t.length?K.emptyPath():Fs(t)}function Rs(e){return new K(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Fs(e){return I(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Vs(e,t,n){return{name:Os(e,t),fields:n.value.mapValue.fields}}function js(e,t,n){const r=Ps(e,t.name),i=As(t.updateTime),s=t.createTime?As(t.createTime):ce.min(),o=new sr({mapValue:{fields:t.fields}}),a=ar.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Bs(e,t){let n;if(t instanceof zi)n={update:Vs(e,t.key,t.value)};else if(t instanceof Hi)n={delete:Os(e,t.key)};else if(t instanceof $i)n={update:Vs(e,t.key,t.data),updateMask:Zs(t.fieldMask)};else{if(!(t instanceof Qi))return w(16599,{Rt:t.type});n={verify:Os(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Si)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ci)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ai)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ki)return{fieldPath:t.field.canonicalString(),increment:n.Ee};throw w(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ds(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:w(27497)}(e,t.precondition)),n}function Us(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Mi.updateTime(As(e.updateTime)):void 0!==e.exists?Mi.exists(e.exists):Mi.none()}(t.currentDocument):Mi.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;if("setToServerValue"in t)I("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new Si;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Ci(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ai(e)}else"increment"in t?n=new ki(e,t.increment):w(16584,{proto:t});const r=W.fromServerFormat(t.fieldPath);return new Pi(r,n)}(e,t)):[];if(t.update){t.update.name;const i=Ps(e,t.update.name),s=new sr({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new fn(t.map(e=>W.fromServerFormat(e)))}(t.updateMask);return new $i(i,s,e,n,r)}return new zi(i,s,n,r)}if(t.delete){const r=Ps(e,t.delete);return new Hi(r,n)}if(t.verify){const r=Ps(e,t.verify);return new Qi(r,n)}return w(1463,{proto:t})}function qs(e,t){return{documents:[Ls(e,t.path)]}}function zs(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ls(e,i);const s=function(e){if(0!==e.length)return Ys(gr.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Xs(e.field),direction:Ws(e.dir)}}(e))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ts(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{Vt:n,parent:i}}function $s(e,t,n,r){const{Vt:i,parent:s}=zs(e,t),o={},a=[];let c=0;return n.forEach(e=>{const t=r?e.alias:"aggregate_"+c++;o[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:Xs(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:Xs(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:i.structuredQuery},parent:i.parent},ft:o,parent:s}}function Ks(e){let t=Ms(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){I(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Gs(e);return t instanceof gr&&vr(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new hr(Js(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ue(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new cr(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new cr(n,t)}(n.endAt)),Ur(t,i,o,s,a,"F",c,u)}function Gs(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Js(e.unaryFilter.field);return pr.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Js(e.unaryFilter.field);return pr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Js(e.unaryFilter.field);return pr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Js(e.unaryFilter.field);return pr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return w(61313);default:return w(60726)}}(e):void 0!==e.fieldFilter?function(e){return pr.create(Js(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return w(58110);default:return w(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return gr.create(e.compositeFilter.filters.map(e=>Gs(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return w(1026)}}(e.compositeFilter.op))}(e):w(30097,{filter:e})}function Ws(e){return bs[e]}function Hs(e){return Is[e]}function Qs(e){return _s[e]}function Xs(e){return{fieldPath:e.canonicalString()}}function Js(e){return W.fromServerFormat(e.fieldPath)}function Ys(e){return e instanceof pr?function(e){if("=="===e.op){if(Qn(e.value))return{unaryFilter:{field:Xs(e.field),op:"IS_NAN"}};if(Hn(e.value))return{unaryFilter:{field:Xs(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Qn(e.value))return{unaryFilter:{field:Xs(e.field),op:"IS_NOT_NAN"}};if(Hn(e.value))return{unaryFilter:{field:Xs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xs(e.field),op:Hs(e.op),value:e.value}}}(e):e instanceof gr?function(e){const t=e.getFilters().map(e=>Ys(e));return 1===t.length?t[0]:{compositeFilter:{op:Qs(e.op),filters:t}}}(e):w(54877,{filter:e})}function Zs(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function eo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class to{constructor(e,t,n,r,i=ce.min(),s=ce.min(),o=gn.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new to(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new to(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new to(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new to(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class no{constructor(e){this.gt=e}}function ro(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:io(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Os(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Ss(e,t.version.toTimestamp()),createTime:Ss(e,t.createTime.toTimestamp())}}(e.gt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:so(t.version)};else{if(!t.isUnknownDocument())return w(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:so(t.version)}}return r}function io(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function so(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function oo(e){const t=new ae(e.seconds,e.nanoseconds);return ce.fromTimestamp(t)}function ao(e,t){const n=(t.baseMutations||[]).map(t=>Us(e.gt,t));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map(t=>Us(e.gt,t)),i=ae.fromMillis(t.localWriteTimeMs);return new Xi(t.batchId,i,n,r)}function co(e){const t=oo(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?oo(e.lastLimboFreeSnapshotVersion):ce.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){const t=e.documents.length;return I(1===t,1966,{count:t}),Gr(qr(Ms(e.documents[0])))}(e.query):function(e){return Gr(Ks(e))}(e.query),new to(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,gn.fromBase64String(e.resumeToken))}function uo(e,t){const n=so(t.snapshotVersion),r=so(t.lastLimboFreeSnapshotVersion);let i;i=Rr(t.target)?qs(e.gt,t.target):zs(e.gt,t.target).Vt;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Lr(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function lo(e){const t=Ks({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Xr(t,t.limit,"L"):t}function ho(e,t){return new Yi(t.largestBatchId,Us(e.gt,t.overlayMutation))}function fo(e,t){const n=t.path.lastSegment();return[e,Ke(t.path.popLast()),n]}function po(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:so(r.readTime),documentKey:Ke(r.documentKey.path),largestBatchId:r.largestBatchId}}class go{getBundleMetadata(e,t){return mo(e).get(t).next(e=>{if(e)return function(e){return{id:e.bundleId,createTime:oo(e.createTime),version:e.version}}(e)})}saveBundleMetadata(e,t){return mo(e).put(function(e){return{bundleId:e.id,createTime:so(As(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return yo(e).get(t).next(e=>{if(e)return function(e){return{name:e.name,query:lo(e.bundledQuery),readTime:oo(e.readTime)}}(e)})}saveNamedQuery(e,t){return yo(e).put(function(e){return{name:e.name,readTime:so(As(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function mo(e){return tn(e,Dt)}function yo(e){return tn(e,At)}class vo{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){const n=t.uid||"";return new vo(e,n)}getOverlay(e,t){return wo(e).get(fo(this.userId,t)).next(e=>e?ho(this.serializer,e):null)}getOverlays(e,t){const n=li();return Te.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((n,i)=>{const s=new Yi(t,i);r.push(this.wt(e,s))}),Te.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e=>r.add(Ke(e.getCollectionPath())));const i=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(wo(e).Y(Ut,r))}),Te.waitFor(i)}getOverlaysForCollection(e,t,n){const r=li(),i=Ke(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return wo(e).j(Ut,s).next(e=>{for(const t of e){const e=ho(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=li();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return wo(e).X({index:zt,range:o},(e,t,n)=>{const o=ho(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()}).next(()=>i)}wt(e,t){return wo(e).put(function(e,t,n){const[r,i,s]=fo(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Bs(e.gt,n.mutation)}}(this.serializer,this.userId,t))}}function wo(e){return tn(e,jt)}class bo{St(e){return tn(e,Kt)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{const t=null==e?void 0:e.value;return t?gn.fromUint8Array(t):gn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Io{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(vn(e.integerValue));else if("doubleValue"in e){const n=vn(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),qe(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&&(n=yn(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(wn(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?Zn(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Jn(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):w(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const n=e.fields||{};this.Ct(t,55);for(const e of Object.keys(n))this.xt(e,t),this.Dt(n[e],t)}Lt(e,t){var n,r;const i=e.fields||{};this.Ct(t,53);const s=Ln,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Ct(t,15),t.Ft(vn(o)),this.xt(s,t),this.Dt(i[s],t)}qt(e,t){const n=e.values||[];this.Ct(t,50);for(const e of n)this.Dt(e,t)}Bt(e,t){this.Ct(t,37),H.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}Io.Ut=new Io;const _o=255;function Eo(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function To(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Eo(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class So{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Wt(n.value),n=t.next();this.Gt()}zt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.jt(n.value),n=t.next();this.Jt()}Ht(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Wt(e);else if(e<2048)this.Wt(960|e>>>6),this.Wt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Wt(480|e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e);else{const e=t.codePointAt(0);this.Wt(240|e>>>18),this.Wt(128|63&e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e)}}this.Gt()}Yt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.jt(e);else if(e<2048)this.jt(960|e>>>6),this.jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.jt(480|e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e);else{const e=t.codePointAt(0);this.jt(240|e>>>18),this.jt(128|63&e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e)}}this.Jt()}Zt(e){const t=this.Xt(e),n=To(t);this.en(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}tn(e){const t=this.Xt(e),n=To(t);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}nn(){this.rn(_o),this.rn(255)}sn(){this._n(_o),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Wt(e){const t=255&e;0===t?(this.rn(0),this.rn(255)):t===_o?(this.rn(_o),this.rn(0)):this.rn(t)}jt(e){const t=255&e;0===t?(this._n(0),this._n(255)):t===_o?(this._n(_o),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Co{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class Do{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class Ao{constructor(){this.un=new So,this.cn=new Co(this.un),this.ln=new Do(this.un)}seed(e){this.un.seed(e)}hn(e){return 0===e?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}class xo{constructor(e,t,n,r){this.Pn=e,this.Tn=t,this.In=n,this.dn=r}En(){const e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new xo(this.Pn,this.Tn,this.In,n)}An(e,t,n){return{indexId:this.Pn,uid:e,arrayValue:Oo(this.In),directionalValue:Oo(this.dn),orderedDocumentKey:Oo(t),documentKey:n.path.toArray()}}Rn(e,t,n){const r=this.An(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function ko(e,t){let n=e.Pn-t.Pn;return 0!==n?n:(n=No(e.In,t.In),0!==n?n:(n=No(e.dn,t.dn),0!==n?n:H.comparator(e.Tn,t.Tn)))}function No(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function Oo(e){return o.isSafariOrWebkit()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function Po(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class Lo{constructor(e){this.Vn=new ln((e,t)=>W.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(const t of e.filters){const e=t;e.isInequality()?this.Vn=this.Vn.add(e):this.fn.push(e)}}get gn(){return this.Vn.size>1}pn(e){if(I(e.collectionGroup===this.collectionId,49279),this.gn)return!1;const t=he(e);if(void 0!==t&&!this.yn(t))return!1;const n=de(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.yn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){const e=this.Vn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.wn(e,t)||!this.Sn(this.mn[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.mn.length||!this.Sn(this.mn[s++],e))return!1}return!0}bn(){if(this.gn)return null;let e=new ln(W.comparator);const t=[];for(const n of this.fn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new pe(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new pe(n.field,0))}for(const n of this.mn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new pe(n.field,"asc"===n.dir?0:1)));return new le(le.UNKNOWN_ID,this.collectionId,t,me.empty())}yn(e){for(const t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Mo(e){var t,n;if(I(e instanceof pr||e instanceof gr,20012),e instanceof pr){if(e instanceof xr){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>pr.create(e.field,"==",t)))||[];return gr.create(r,"or")}return e}const r=e.filters.map(e=>Mo(e));return gr.create(r,e.op)}function Ro(e){if(0===e.getFilters().length)return[];const t=Bo(Mo(e));return I(jo(t),7391),Fo(t)||Vo(t)?[t]:t.getFilters()}function Fo(e){return e instanceof pr}function Vo(e){return e instanceof gr&&vr(e)}function jo(e){return Fo(e)||Vo(e)||function(e){if(e instanceof gr&&yr(e)){for(const t of e.getFilters())if(!Fo(t)&&!Vo(t))return!1;return!0}return!1}(e)}function Bo(e){if(I(e instanceof pr||e instanceof gr,34018),e instanceof pr)return e;if(1===e.filters.length)return Bo(e.filters[0]);const t=e.filters.map(e=>Bo(e));let n=gr.create(t,e.op);return n=zo(n),jo(n)?n:(I(n instanceof gr,64498),I(mr(n),40251),I(n.filters.length>1,57927),n.filters.reduce((e,t)=>Uo(e,t)))}function Uo(e,t){let n;return I(e instanceof pr||e instanceof gr,38388),I(t instanceof pr||t instanceof gr,25473),n=e instanceof pr?t instanceof pr?function(e,t){return gr.create([e,t],"and")}(e,t):qo(e,t):t instanceof pr?qo(t,e):function(e,t){if(I(e.filters.length>0&&t.filters.length>0,48005),mr(e)&&mr(t))return _r(e,t.getFilters());const n=yr(e)?e:t,r=yr(e)?t:e,i=n.filters.map(e=>Uo(e,r));return gr.create(i,"or")}(e,t),zo(n)}function qo(e,t){if(mr(t))return _r(t,e.getFilters());{const n=t.filters.map(t=>Uo(e,t));return gr.create(n,"or")}}function zo(e){if(I(e instanceof pr||e instanceof gr,11850),e instanceof pr)return e;const t=e.getFilters();if(1===t.length)return zo(t[0]);if(wr(e))return e;const n=t.map(e=>zo(e)),r=[];return n.forEach(t=>{t instanceof pr?r.push(t):t instanceof gr&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:gr.create(r,e.op)}class $o{constructor(){this.Dn=new Ko}addToCollectionParentIndex(e,t){return this.Dn.add(t),Te.resolve()}getCollectionParents(e,t){return Te.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return Te.resolve()}deleteFieldIndex(e,t){return Te.resolve()}deleteAllFieldIndexes(e){return Te.resolve()}createTargetIndexes(e,t){return Te.resolve()}getDocumentsMatchingTarget(e,t){return Te.resolve(null)}getIndexType(e,t){return Te.resolve(0)}getFieldIndexes(e,t){return Te.resolve([])}getNextCollectionGroupToUpdate(e){return Te.resolve(null)}getMinOffset(e,t){return Te.resolve(we.min())}getMinOffsetFromCollectionGroup(e,t){return Te.resolve(we.min())}updateCollectionGroup(e,t,n){return Te.resolve()}updateIndexEntries(e,t){return Te.resolve()}}class Ko{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ln(K.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ln(K.comparator)).toArray()}}const Go="IndexedDbIndexManager",Wo=new Uint8Array(0);class Ho{constructor(e,t){this.databaseId=t,this.vn=new Ko,this.Cn=new ii(e=>Lr(e),(e,t)=>Mr(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:n,parent:Ke(r)};return Qo(e).put(i)}return Te.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[q(t),""],!1,!0);return Qo(e).j(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(He(r.parent))}return n})}addFieldIndex(e,t){const n=Jo(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Yo(e);return i.next(e=>{n.put(po(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=Jo(e),r=Yo(e),i=Xo(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Jo(e),n=Xo(e),r=Yo(e);return t.Y().next(()=>n.Y()).next(()=>r.Y())}createTargetIndexes(e,t){return Te.forEach(this.Fn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){const n=new Lo(t).bn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){const n=Xo(e);let r=!0;const i=new Map;return Te.forEach(this.Fn(t),t=>this.Mn(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=gi();const r=[];return Te.forEach(i,(i,s)=>{g(Go,`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}(i)} to execute ${Lr(t)}`);const o=function(e,t){const n=he(t);if(void 0===n)return null;for(const t of Fr(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of de(t))for(const t of Fr(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of de(t)){const t=0===i.kind?Vr(e,i.fieldPath,e.startAt):jr(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new cr(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of de(t)){const t=0===i.kind?jr(e,i.fieldPath,e.endAt):Vr(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new cr(n,r)}(s,i),l=this.xn(i,s,c),h=this.xn(i,s,u),d=this.On(i,s,a),f=this.Nn(i.indexId,o,l,c.inclusive,h,u.inclusive,d);return Te.forEach(f,i=>n.H(i,t.limit).next(t=>{t.forEach(t=>{const n=H.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return Te.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:Ro(gr.create(e.filters,"and")).map(t=>Pr(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Bn(t[l/c]):Wo,h=this.Ln(e,a,n[l%c],r),d=this.kn(e,a,i[l%c],s),f=o.map(t=>this.Ln(e,a,t,!0));u.push(...this.createRange(h,d,f))}return u}Ln(e,t,n,r){const i=new xo(e,H.empty(),t,n);return r?i:i.En()}kn(e,t,n,r){const i=new xo(e,H.empty(),t,n);return r?i.En():i}Mn(e,t){const n=new Lo(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)n.pn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2;const r=this.Fn(t);return Te.forEach(r,t=>this.Mn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new ln(W.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n)}qn(e,t){const n=new Ao;for(const r of de(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.hn(r.kind);Io.Ut.bt(e,i)}return n.an()}Bn(e){const t=new Ao;return Io.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){const n=new Ao;return Io.Ut.bt(Kn(this.databaseId,t),n.hn(function(e){const t=de(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.an()}On(e,t,n){if(null===n)return[];let r=[];r.push(new Ao);let i=0;for(const s of de(e)){const e=n[i++];for(const n of r)if(this.$n(t,s.fieldPath)&&Wn(e))r=this.Un(r,s,e);else{const t=n.hn(s.kind);Io.Ut.bt(e,t)}}return this.Kn(r)}xn(e,t,n){return this.On(e,t,n.position)}Kn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].an();return t}Un(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Ao;r.seed(n.an()),Io.Ut.bt(e,r.hn(t.kind)),i.push(r)}return i}$n(e,t){return!!e.filters.find(e=>e instanceof pr&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Jo(e),r=Yo(e);return(t?n.j(kt,IDBKeyRange.bound(t,t)):n.j()).next(e=>{const t=[];return Te.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){const n=t?new me(t.sequenceNumber,new we(oo(t.readTime),new H(He(t.documentKey)),t.largestBatchId)):me.empty(),r=e.fields.map(([e,t])=>new pe(W.fromServerFormat(e),t));return new le(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:F(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=Jo(e),i=Yo(e);return this.Wn(e).next(e=>r.j(kt,IDBKeyRange.bound(t,t)).next(t=>Te.forEach(t,t=>i.put(po(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){const n=new Map;return Te.forEach(t,(t,r)=>{const i=n.get(t.collectionGroup);return(i?Te.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),Te.forEach(i,n=>this.Gn(e,t,n).next(t=>{const i=this.zn(r,n);return t.isEqual(i)?Te.resolve():this.jn(e,r,n,t,i)}))))})}Jn(e,t,n,r){return Xo(e).put(r.An(this.uid,this.Qn(n,t.key),t.key))}Hn(e,t,n,r){return Xo(e).delete(r.Rn(this.uid,this.Qn(n,t.key),t.key))}Gn(e,t,n){const r=Xo(e);let i=new ln(ko);return r.X({index:Ft,range:IDBKeyRange.only([n.indexId,this.uid,Oo(this.Qn(n,t))])},(e,r)=>{i=i.add(new xo(n.indexId,t,Po(r.arrayValue),Po(r.directionalValue)))}).next(()=>i)}zn(e,t){let n=new ln(ko);const r=this.qn(t,e);if(null==r)return n;const i=he(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Wn(s))for(const i of s.arrayValue.values||[])n=n.add(new xo(t.indexId,e.key,this.Bn(i),r))}else n=n.add(new xo(t.indexId,e.key,Wo,r));return n}jn(e,t,n,r,i){g(Go,"Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=dn(s),c=dn(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=dn(o)):t?(i(a),a=dn(s)):(a=dn(s),c=dn(o))}}(r,i,ko,r=>{s.push(this.Jn(e,t,n,r))},r=>{s.push(this.Hn(e,t,n,r))}),Te.waitFor(s)}Wn(e){let t=1;return Yo(e).X({index:Pt,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>ko(e,t)).filter((e,t,n)=>!t||0!==ko(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=ko(i,e),s=ko(i,t);if(0===n)r[0]=e.En();else if(n>0&&s<0)r.push(i),r.push(i.En());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Yn(r[e],r[e+1]))return[];const t=r[e].Rn(this.uid,Wo,H.empty()),n=r[e+1].Rn(this.uid,Wo,H.empty());i.push(IDBKeyRange.bound(t,n))}return i}Yn(e,t){return ko(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Zo)}getMinOffset(e,t){return Te.mapArray(this.Fn(t),t=>this.Mn(e,t).next(e=>e||w(44426))).next(Zo)}}function Qo(e){return tn(e,Tt)}function Xo(e){return tn(e,Mt)}function Jo(e){return tn(e,xt)}function Yo(e){return tn(e,Nt)}function Zo(e){I(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;be(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new we(t.readTime,t.documentKey,n)}const ea={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ta=41943040;class na{static withCacheSize(e){return new na(e,na.DEFAULT_COLLECTION_PERCENTILE,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function ra(e,t,n){const r=e.store(Ze),i=e.store(ot),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{I(1===a,47070,{batchId:n.batchId})}));const u=[];for(const e of n.mutations){const r=it(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return Te.waitFor(s).next(()=>u)}function ia(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw w(14731);t=e.noDocument}return JSON.stringify(t).length}na.DEFAULT_COLLECTION_PERCENTILE=10,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,na.DEFAULT=new na(ta,na.DEFAULT_COLLECTION_PERCENTILE,na.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),na.DISABLED=new na(-1,0,0);class sa{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static yt(e,t,n,r){I(""!==e.uid,64387);const i=e.isAuthenticated()?e.uid:"";return new sa(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(e).X({index:tt,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=ca(e),s=aa(e);return s.add({}).next(o=>{I("number"==typeof o,49019);const a=new Xi(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>Bs(e.gt,t)),i=n.mutations.map(t=>Bs(e.gt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new ln((e,t)=>F(e.canonicalString(),t.canonicalString()));for(const e of r){const t=it(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,st))}return l.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[o]=a.keys()}),Te.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return aa(e).get(t).next(e=>e?(I(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),ao(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?Te.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return aa(e).X({index:tt,range:r},(e,t,r)=>{t.userId===this.userId&&(I(t.batchId>=n,47524,{er:n}),i=ao(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Be;return aa(e).X({index:tt,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Be],[this.userId,Number.POSITIVE_INFINITY]);return aa(e).j(tt,t).next(e=>e.map(e=>ao(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=rt(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return ca(e).X({range:r},(n,r,s)=>{const[o,a,c]=n,u=He(a);if(o===this.userId&&t.path.isEqual(u))return aa(e).get(c).next(e=>{if(!e)throw w(61480,{tr:n,batchId:c});I(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:c}),i.push(ao(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ln(F);const r=[];return t.forEach(t=>{const i=rt(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=ca(e).X({range:s},(e,r,i)=>{const[s,o,a]=e,c=He(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()});r.push(o)}),Te.waitFor(r).next(()=>this.nr(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=rt(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new ln(F);return ca(e).X({range:s},(e,t,i)=>{const[s,a,c]=e,u=He(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()}).next(()=>this.nr(e,o))}nr(e,t){const n=[],r=[];return t.forEach(t=>{r.push(aa(e).get(t).next(e=>{if(null===e)throw w(35274,{batchId:t});I(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(ao(this.serializer,e))}))}),Te.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return ra(e.ce,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),Te.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return Te.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return ca(e).X({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=He(e[1]);r.push(t)}else n.done()}).next(()=>{I(0===r.length,56720,{ir:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return oa(e,this.userId,t)}sr(e){return ua(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Be,lastStreamToken:""})}}function oa(e,t,n){const r=rt(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return ca(e).X({range:s,Z:!0},(e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function aa(e){return tn(e,Ze)}function ca(e){return tn(e,ot)}function ua(e){return tn(e,Ye)}class la{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new la(0)}static ur(){return new la(-1)}}class ha{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{const n=new la(t.highestTargetId);return t.highestTargetId=n.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(e=>ce.fromTimestamp(new ae(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.cr(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.lr(e,r)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(n=>(n.targetCount+=1,this.Pr(t,n),this.lr(e,n))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>da(e).delete(t.targetId)).next(()=>this.cr(e)).next(t=>(I(t.targetCount>0,8065),t.targetCount-=1,this.lr(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return da(e).X((s,o)=>{const a=co(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>Te.waitFor(i)).next(()=>r)}forEachTarget(e,t){return da(e).X((e,n)=>{const r=co(n);t(r)})}cr(e){return fa(e).get(_t).next(e=>(I(null!==e,2888),e))}lr(e,t){return fa(e).put(_t,t)}hr(e,t){return da(e).put(uo(this.serializer,t))}Pr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.cr(e).next(e=>e.targetCount)}getTargetData(e,t){const n=Lr(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return da(e).X({range:r,index:mt},(e,n,r)=>{const s=co(n);Mr(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=pa(e);return t.forEach(t=>{const s=Ke(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),Te.waitFor(r)}removeMatchingKeys(e,t,n){const r=pa(e);return Te.forEach(t,t=>{const i=Ke(t.path);return Te.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=pa(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=pa(e);let i=gi();return r.X({range:n,Z:!0},(e,t,n)=>{const r=He(e[1]),s=new H(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=Ke(t.path),r=IDBKeyRange.bound([n],[q(n)],!1,!0);let i=0;return pa(e).X({index:bt,Z:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}Et(e,t){return da(e).get(t).next(e=>e?co(e):null)}}function da(e){return tn(e,gt)}function fa(e){return tn(e,Et)}function pa(e){return tn(e,vt)}const ga="LruGarbageCollector",ma=1048576;function ya([e,t],[n,r]){const i=F(e,n);return 0===i?F(t,r):i}class va{constructor(e){this.Tr=e,this.buffer=new ln(ya),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ya(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wa{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){g(ga,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ne(e)?g(ga,"Ignoring IndexedDB error during garbage collection: ",e):await Ee(e)}await this.Rr(3e5)})}}class ba{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Te.resolve(je.ue);const n=new va(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(g("LruGarbageCollector","Garbage collection skipped; disabled"),Te.resolve(ea)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(g("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ea):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,r,i,o,a,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(g("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),p()<=s.LogLevel.DEBUG&&g("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${r} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),Te.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function Ia(e,t){return new ba(e,t)}class _a{constructor(e,t){this.db=e,this.garbageCollector=Ia(this,t)}mr(e){const t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(e,n)=>t(n))}addReference(e,t,n){return Ea(e,n)}removeReference(e,t,n){return Ea(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ea(e,t)}Sr(e,t){return function(e,t){let n=!1;return ua(e).ee(r=>oa(e,r,t).next(e=>(e&&(n=!0),Te.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.wr(e,(s,o)=>{if(o<=t){const t=this.Sr(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ce.min()),pa(e).delete(function(e){return[0,Ke(e.path)]}(s))))});r.push(t)}}).next(()=>Te.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ea(e,t)}wr(e,t){const n=pa(e);let r,i=je.ue;return n.X({index:bt},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==je.ue&&t(new H(He(r)),i),i=o,r=s):i=je.ue}).next(()=>{i!==je.ue&&t(new H(He(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ea(e,t){return pa(e).put(function(e,t){return{targetId:0,path:Ke(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Ta{constructor(){this.changes=new ii(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ar.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Te.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Sa{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return xa(e).put(n)}removeEntry(e,t,n){return xa(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],io(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=ar.newInvalidDocument(t);return xa(e).X({index:ut,range:IDBKeyRange.only(ka(t))},(e,r)=>{n=this.Dr(t,r)}).next(()=>n)}vr(e,t){let n={size:0,document:ar.newInvalidDocument(t)};return xa(e).X({index:ut,range:IDBKeyRange.only(ka(t))},(e,r)=>{n={document:this.Dr(t,r),size:ia(r)}}).next(()=>n)}getEntries(e,t){let n=oi();return this.Cr(e,t,(e,t)=>{const r=this.Dr(e,t);n=n.insert(e,r)}).next(()=>n)}Fr(e,t){let n=oi(),r=new an(H.comparator);return this.Cr(e,t,(e,t)=>{const i=this.Dr(e,t);n=n.insert(e,i),r=r.insert(e,ia(t))}).next(()=>({documents:n,Mr:r}))}Cr(e,t,n){if(t.isEmpty())return Te.resolve();let r=new ln(Oa);t.forEach(e=>r=r.add(e));const i=IDBKeyRange.bound(ka(r.first()),ka(r.last())),s=r.getIterator();let o=s.getNext();return xa(e).X({index:ut,range:i},(e,t,r)=>{const i=H.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Oa(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(ka(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),io(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xa(e).j(IDBKeyRange.bound(o,a,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=oi();for(const i of e){const e=this.Dr(H.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(ei(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=oi();const s=Na(t,n),o=Na(t,we.max());return xa(e).X({index:ht,range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{const s=this.Dr(H.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new Da(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Aa(e).get(pt).next(e=>(I(!!e,20021),e))}br(e,t){return Aa(e).put(pt,t)}Dr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=js(e.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=H.fromSegments(t.noDocument.path),r=oo(t.noDocument.readTime);n=ar.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return w(56709);{const e=H.fromSegments(t.unknownDocument.path),r=oo(t.unknownDocument.version);n=ar.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new ae(e[0],e[1]);return ce.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ce.min()))return e}return ar.newInvalidDocument(e)}}function Ca(e){return new Sa(e)}class Da extends Ta{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new ii(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new ln((e,t)=>F(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.Nr.get(i);if(t.push(this.Or.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=ro(this.Or.serializer,s);r=r.add(i.path.popLast());const c=ia(a);n+=c-o.size,t.push(this.Or.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=ro(this.Or.serializer,s.convertToNoDocument(ce.min()));t.push(this.Or.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Or.updateMetadata(e,n)),Te.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(e=>(this.Nr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:e,Mr:t})=>(t.forEach((t,n)=>{this.Nr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function Aa(e){return tn(e,ft)}function xa(e){return tn(e,at)}function ka(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Na(e,t){const n=t.documentKey.path.toArray();return[e,io(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Oa(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=F(n[e],r[e]),i)return i;return i=F(n.length,r.length),i||(i=F(n[n.length-2],r[r.length-2]),i||F(n[n.length-1],r[r.length-1]))}class Pa{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class La{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Bi(n.mutation,e,fn.empty(),ae.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,gi()).next(()=>t))}getLocalViewOfDocuments(e,t,n=gi()){const r=li();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=ci();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=li();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,gi()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=oi();const s=di(),o=di();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof $i)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Bi(o.mutation,t,o.mutation.getFieldMask(),ae.now())):s.set(t.key,fn.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Pa(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=di();let r=new an((e,t)=>e-t),i=gi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||fn.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||gi()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=hi();c.forEach(e=>{if(!i.has(e)){const r=Vi(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Te.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return H.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):$r(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Te.resolve(li());let o=ue,a=i;return s.next(t=>Te.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Te.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,gi())).next(e=>({batchId:o,changes:ui(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(e=>{let t=ci();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=ci();return this.indexManager.getCollectionParents(e,i).next(o=>Te.forEach(o,o=>{const a=function(e,t){return new Br(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ar.newInvalidDocument(r)))});let n=ci();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&Bi(s.mutation,r,fn.empty(),ae.now()),ei(t,r)&&(n=n.insert(e,r))}),n})}}class Ma{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return Te.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(e){return{id:e.id,version:e.version,createTime:As(e.createTime)}}(t)),Te.resolve()}getNamedQuery(e,t){return Te.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(e){return{name:e.name,query:lo(e.bundledQuery),readTime:As(e.readTime)}}(t)),Te.resolve()}}class Ra{constructor(){this.overlays=new an(H.comparator),this.kr=new Map}getOverlay(e,t){return Te.resolve(this.overlays.get(t))}getOverlays(e,t){const n=li();return Te.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.wt(e,t,r)}),Te.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.kr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(n)),Te.resolve()}getOverlaysForCollection(e,t,n){const r=li(),i=t.length+1,s=new H(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Te.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new an((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=li(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=li(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Te.resolve(o)}wt(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.kr.get(r.largestBatchId).delete(n.key);this.kr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Yi(t,n));let i=this.kr.get(t);void 0===i&&(i=gi(),this.kr.set(t,i)),this.kr.set(t,i.add(n.key))}}class Fa{constructor(){this.sessionToken=gn.EMPTY_BYTE_STRING}getSessionToken(e){return Te.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Te.resolve()}}class Va{constructor(){this.qr=new ln(ja.Qr),this.$r=new ln(ja.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const n=new ja(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new ja(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){const t=new H(new K([])),n=new ja(t,e),r=new ja(t,e+1),i=[];return this.$r.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new H(new K([])),n=new ja(t,e),r=new ja(t,e+1);let i=gi();return this.$r.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new ja(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ja{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return H.comparator(e.key,t.key)||F(e.Hr,t.Hr)}static Ur(e,t){return F(e.Hr,t.Hr)||H.comparator(e.key,t.key)}}class Ba{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new ln(ja.Qr)}checkEmpty(e){return Te.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Xi(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Yr=this.Yr.add(new ja(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Te.resolve(s)}lookupMutationBatch(e,t){return Te.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Xr(n),i=r<0?0:r;return Te.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Te.resolve(0===this.mutationQueue.length?Be:this.er-1)}getAllMutationBatches(e){return Te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ja(t,0),r=new ja(t,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([n,r],e=>{const t=this.Zr(e.Hr);i.push(t)}),Te.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ln(F);return t.forEach(e=>{const t=new ja(e,0),r=new ja(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),Te.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;H.isDocumentKey(i)||(i=i.child(""));const s=new ja(new H(i),0);let o=new ln(F);return this.Yr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Hr)),!0)},s),Te.resolve(this.ei(o))}ei(e){const t=[];return e.forEach(e=>{const n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){I(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return Te.forEach(t.mutations,r=>{const i=new ja(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){const n=new ja(t,0),r=this.Yr.firstAfterOrEqual(n);return Te.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Te.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ua{constructor(e){this.ni=e,this.docs=new an(H.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Te.resolve(n?n.document.mutableCopy():ar.newInvalidDocument(t))}getEntries(e,t){let n=oi();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ar.newInvalidDocument(e))}),Te.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=oi();const s=t.path,o=new H(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||be(ve(o),n)<=0||(r.has(o.key)||ei(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Te.resolve(i)}getAllFromCollectionGroup(e,t,n,r){w(9500)}ri(e,t){return Te.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new qa(this)}getSize(e){return Te.resolve(this.size)}}class qa extends Ta{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Or.addEntry(e,r)):this.Or.removeEntry(n)}),Te.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class za{constructor(e){this.persistence=e,this.ii=new ii(e=>Lr(e),Mr),this.lastRemoteSnapshotVersion=ce.min(),this.highestTargetId=0,this.si=0,this.oi=new Va,this.targetCount=0,this._i=la.ar()}forEachTarget(e,t){return this.ii.forEach((e,n)=>t(n)),Te.resolve()}getLastRemoteSnapshotVersion(e){return Te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Te.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),Te.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),Te.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new la(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,Te.resolve()}updateTargetData(e,t){return this.hr(t),Te.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,Te.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.ii.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ii.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Te.waitFor(i).next(()=>r)}getTargetCount(e){return Te.resolve(this.targetCount)}getTargetData(e,t){const n=this.ii.get(t)||null;return Te.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),Te.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Te.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),Te.resolve()}getMatchingKeysForTargetId(e,t){const n=this.oi.Jr(t);return Te.resolve(n)}containsKey(e,t){return Te.resolve(this.oi.containsKey(t))}}class $a{constructor(e,t){this.ai={},this.overlays={},this.ui=new je(0),this.ci=!1,this.ci=!0,this.li=new Fa,this.referenceDelegate=e(this),this.hi=new za(this),this.indexManager=new $o,this.remoteDocumentCache=function(e){return new Ua(e)}(e=>this.referenceDelegate.Pi(e)),this.serializer=new no(t),this.Ti=new Ma(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ra,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new Ba(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){g("MemoryPersistence","Starting transaction:",e);const r=new Ka(this.ui.next());return this.referenceDelegate.Ii(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return Te.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}}class Ka extends _e{constructor(e){super(),this.currentSequenceNumber=e}}class Ga{constructor(e){this.persistence=e,this.Ai=new Va,this.Ri=null}static Vi(e){return new Ga(e)}get mi(){if(this.Ri)return this.Ri;throw w(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),Te.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),Te.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),Te.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Te.forEach(this.mi,n=>{const r=H.fromPath(n);return this.fi(e,r).next(e=>{e||t.removeEntry(r,ce.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return Te.or([()=>Te.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Wa{constructor(e,t){this.persistence=e,this.gi=new ii(e=>Ke(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=Ia(this,t)}static Vi(e,t){return new Wa(e,t)}Ii(){}di(e){return Te.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return Te.forEach(this.gi,(n,r)=>this.Sr(e,n,r).next(e=>e?Te.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ri(e,r=>this.Sr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ce.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),Te.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),Te.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),Te.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),Te.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=$n(e.data.value)),t}Sr(e,t,n){return Te.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.gi.get(t);return Te.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ha{constructor(e){this.serializer=e}q(e,t,n,r){const i=new Ce("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(Xe)}(e),function(e){e.createObjectStore(Ye,{keyPath:"userId"}),e.createObjectStore(Ze,{keyPath:et,autoIncrement:!0}).createIndex(tt,nt,{unique:!0}),e.createObjectStore(ot)}(e),Qa(e),function(e){e.createObjectStore(Qe)}(e));let s=Te.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(vt),e.deleteObjectStore(gt),e.deleteObjectStore(Et)}(e),Qa(e)),s=s.next(()=>function(e){const t=e.store(Et),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ce.min().toTimestamp(),targetCount:0};return t.put(_t,n)}(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store(Ze).j().next(n=>{e.deleteObjectStore(Ze),e.createObjectStore(Ze,{keyPath:et,autoIncrement:!0}).createIndex(tt,nt,{unique:!0});const r=t.store(Ze),i=n.map(e=>r.put(e));return Te.waitFor(i)})}(e,i))),s=s.next(()=>{!function(e){e.createObjectStore(Ct,{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.pi(i))),n<6&&r>=6&&(s=s.next(()=>(function(e){e.createObjectStore(ft)}(e),this.yi(i)))),n<7&&r>=7&&(s=s.next(()=>this.wi(i))),n<8&&r>=8&&(s=s.next(()=>this.Si(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(s=s.next(()=>this.bi(i))),n<11&&r>=11&&(s=s.next(()=>{!function(e){e.createObjectStore(Dt,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(At,{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){const t=e.createObjectStore(jt,{keyPath:Bt});t.createIndex(Ut,qt,{unique:!1}),t.createIndex(zt,$t,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>function(e){const t=e.createObjectStore(at,{keyPath:ct});t.createIndex(ut,lt),t.createIndex(ht,dt)}(e)).next(()=>this.Di(e,i)).next(()=>e.deleteObjectStore(Qe))),n<14&&r>=14&&(s=s.next(()=>this.Ci(e,i))),n<15&&r>=15&&(s=s.next(()=>function(e){e.createObjectStore(xt,{keyPath:"indexId",autoIncrement:!0}).createIndex(kt,"collectionGroup",{unique:!1}),e.createObjectStore(Nt,{keyPath:Ot}).createIndex(Pt,Lt,{unique:!1}),e.createObjectStore(Mt,{keyPath:Rt}).createIndex(Ft,Vt,{unique:!1})}(e))),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(Nt).clear()}).next(()=>{t.objectStore(Mt).clear()})),n<17&&r>=17&&(s=s.next(()=>{!function(e){e.createObjectStore(Kt,{keyPath:"name"})}(e)})),n<18&&r>=18&&o.isSafariOrWebkit()&&(s=s.next(()=>{t.objectStore(Nt).clear()}).next(()=>{t.objectStore(Mt).clear()})),s}yi(e){let t=0;return e.store(Qe).X((e,n)=>{t+=ia(n)}).next(()=>{const n={byteSize:t};return e.store(ft).put(pt,n)})}pi(e){const t=e.store(Ye),n=e.store(Ze);return t.j().next(t=>Te.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,Be],[t.userId,t.lastAcknowledgedBatchId]);return n.j(tt,r).next(n=>Te.forEach(n,n=>{I(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const r=ao(this.serializer,n);return ra(e,t.userId,r).next(()=>{})}))}))}wi(e){const t=e.store(vt),n=e.store(Qe);return e.store(Et).get(_t).next(e=>{const r=[];return n.X((n,i)=>{const s=new K(n),o=function(e){return[0,Ke(e)]}(s);r.push(t.get(o).next(n=>n?Te.resolve():(n=>t.put({targetId:0,path:Ke(n),sequenceNumber:e.highestListenSequenceNumber}))(s)))}).next(()=>Te.waitFor(r))})}Si(e,t){e.createObjectStore(Tt,{keyPath:St});const n=t.store(Tt),r=new Ko,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ke(r)})}};return t.store(Qe).X({Z:!0},(e,t)=>{const n=new K(e);return i(n.popLast())}).next(()=>t.store(ot).X({Z:!0},([e,t,n],r)=>{const s=He(t);return i(s.popLast())}))}bi(e){const t=e.store(gt);return t.X((e,n)=>{const r=co(n),i=uo(this.serializer,r);return t.put(i)})}Di(e,t){const n=t.store(Qe),r=[];return n.X((e,n)=>{const i=t.store(at),s=function(e){return e.document?new H(K.fromString(e.document.name).popFirst(5)):e.noDocument?H.fromSegments(e.noDocument.path):e.unknownDocument?H.fromSegments(e.unknownDocument.path):w(36783)}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))}).next(()=>Te.waitFor(r))}Ci(e,t){const n=t.store(Ze),r=Ca(this.serializer),i=new $a(Ga.Vi,this.serializer.gt);return n.j().next(e=>{const n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:gi();ao(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),Te.forEach(n,(e,n)=>{const s=new h(n),o=vo.yt(this.serializer,s),a=i.getIndexManager(s),c=sa.yt(s,this.serializer,a,i.referenceDelegate);return new La(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new en(t,je.ue),e).next()})})}}function Qa(e){e.createObjectStore(vt,{keyPath:wt}).createIndex(bt,It,{unique:!0}),e.createObjectStore(gt,{keyPath:"targetId"}).createIndex(mt,yt,{unique:!0}),e.createObjectStore(Et)}const Xa="IndexedDbPersistence",Ja=18e5,Ya=5e3,Za="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ec="main";class tc{constructor(e,t,n,r,i,s,o,a,c,u,l=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Fi=i,this.window=s,this.document=o,this.Mi=c,this.xi=u,this.Oi=l,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=e=>Promise.resolve(),!tc.C())throw new T(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new _a(this,r),this.Qi=t+ec,this.serializer=new no(a),this.$i=new De(this.Qi,this.Oi,new Ha(this.serializer)),this.li=new bo,this.hi=new ha(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ca(this.serializer),this.Ti=new go,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&m(Xa,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,Za);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new je(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>rc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(Ne(e))return g(Xa,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return g(Xa,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return nc(e).get(Je).next(e=>Te.resolve(this.Xi(e)))}es(e){return rc(e).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,Ja)){this.ki=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=tn(e,Ct);return t.j().next(e=>{const n=this.rs(e,Ja),r=e.filter(e=>-1===n.indexOf(e));return Te.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ui)for(const t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?Te.resolve(!0):nc(e).get(Je).next(t=>{if(null!==t&&this.ns(t.leaseTimestampMs,Ya)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,Za);return!1}}return!(!this.networkEnabled||!this.inForeground)||rc(e).j().next(e=>void 0===this.rs(e,Ya).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&g(Xa,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[Xe,Ct],e=>{const t=new en(e,je.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(e=>this.ns(e.updateTimeMs,t)&&!this._s(e.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>rc(e).j().next(e=>this.rs(e,Ja).map(e=>e.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return sa.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ho(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return vo.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,n){g(Xa,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 18===e?Zt:17===e?Yt:16===e?Jt:15===e?Xt:14===e?Qt:13===e?Ht:12===e?Wt:11===e?Gt:void w(60245)}(this.Oi);let s;return this.$i.runTransaction(e,r,i,r=>(s=new en(r,this.ui?this.ui.next():je.ue),"readwrite-primary"===t?this.Ji(s).next(e=>!!e||this.Hi(s)).next(t=>{if(!t)throw m(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new T(E.FAILED_PRECONDITION,Ie);return n(s)}).next(e=>this.Zi(s).next(()=>e)):this.Ts(s).next(()=>n(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Ts(e){return nc(e).get(Je).next(e=>{if(null!==e&&this.ns(e.leaseTimestampMs,Ya)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new T(E.FAILED_PRECONDITION,Za)})}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return nc(e).put(Je,t)}static C(){return De.C()}Yi(e){const t=nc(e);return t.get(Je).next(e=>this.Xi(e)?(g(Xa,"Releasing primary lease."),t.delete(Je)):Te.resolve())}ns(e,t){const n=Date.now();return!(e<n-t||e>n&&(m(`Detected an update time that is in the future: ${e} > ${n}`),1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground="visible"===this.document.visibilityState)}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ni=()=>{this.us();const e=/(?:Version|Mobile)\/1[456]/;o.isSafari()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{const n=null!==(null===(t=this.Ui)||void 0===t?void 0:t.getItem(this.ss(e)));return g(Xa,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return m(Xa,"Failed to get zombied client id.",e),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){m("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch(e){}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function nc(e){return tn(e,Xe)}function rc(e){return tn(e,Ct)}function ic(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class sc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=r}static Es(e,t){let n=gi(),r=gi();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sc(e,t.fromCache,n,r)}}class oc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ac{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=o.isSafari()?8:Ae(o.getUA())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ps(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new oc;return this.ws(e,t,n).next(r=>{if(i.result=r,this.Rs)return this.Ss(e,t,n,r.size)})}).next(()=>i.result)}Ss(e,t,n,r){return n.documentReadCount<this.Vs?(p()<=s.LogLevel.DEBUG&&g("QueryEngine","SDK will not create cache indexes for query:",Zr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Te.resolve()):(p()<=s.LogLevel.DEBUG&&g("QueryEngine","Query:",Zr(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.fs*r?(p()<=s.LogLevel.DEBUG&&g("QueryEngine","The SDK decides to create cache indexes for query:",Zr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gr(t))):Te.resolve())}ps(e,t){if(zr(t))return Te.resolve(null);let n=Gr(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Xr(t,null,"F"),n=Gr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=gi(...r);return this.gs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.bs(t,r);return this.Ds(t,s,i,n.readTime)?this.ps(e,Xr(t,null,"F")):this.vs(e,s,t,n)}))})))}ys(e,t,n,r){return zr(t)||r.isEqual(ce.min())?Te.resolve(null):this.gs.getDocuments(e,n).next(i=>{const o=this.bs(t,i);return this.Ds(t,o,n,r)?Te.resolve(null):(p()<=s.LogLevel.DEBUG&&g("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Zr(t)),this.vs(e,o,t,ye(r,ue)).next(e=>e))})}bs(e,t){let n=new ln(ni(e));return t.forEach((t,r)=>{ei(e,r)&&(n=n.add(r))}),n}Ds(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ws(e,t,n){return p()<=s.LogLevel.DEBUG&&g("QueryEngine","Using full collection scan to execute query:",Zr(t)),this.gs.getDocumentsMatchingQuery(e,t,we.min(),n)}vs(e,t,n,r){return this.gs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const cc="LocalStore";class uc{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.Fs=new an(F),this.Ms=new ii(e=>Lr(e),Mr),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new La(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function lc(e,t,n,r){return new uc(e,t,n,r)}async function hc(e,t){const n=_(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Ns(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=gi();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Bs:e,removedBatchIds:i,addedBatchIds:s}))})})}function dc(e){const t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function fc(e,t,n){let r=gi(),i=gi();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=oi();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ce.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):g(cc,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Ls:r,ks:i}})}function pc(e,t){const n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=Be),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function gc(e,t){const n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.hi.getTargetData(e,t).next(i=>i?(r=i,Te.resolve(r)):n.hi.allocateTargetId(e).next(i=>(r=new to(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.hi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Fs.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fs=n.Fs.insert(e.targetId,e),n.Ms.set(t,e.targetId)),e})}async function mc(e,t,n){const r=_(e),i=r.Fs.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Ne(e))throw e;g(cc,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Fs=r.Fs.remove(t),r.Ms.delete(i.target)}function yc(e,t,n){const r=_(e);let i=ce.min(),s=gi();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=_(e),i=r.Ms.get(n);return void 0!==i?Te.resolve(r.Fs.get(i)):r.hi.getTargetData(t,n)}(r,e,Gr(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Cs.getDocumentsMatchingQuery(e,t,n?i:ce.min(),n?s:gi())).next(e=>(bc(r,ti(t),e),{documents:e,qs:s})))}function vc(e,t){const n=_(e),r=_(n.hi),i=n.Fs.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Et(e,t).next(e=>e?e.target:null))}function wc(e,t){const n=_(e),r=n.xs.get(t)||ce.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Os.getAllFromCollectionGroup(e,t,ye(r,ue),Number.MAX_SAFE_INTEGER)).then(e=>(bc(n,t,e),e))}function bc(e,t,n){let r=e.xs.get(t)||ce.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.xs.set(t,r)}async function Ic(e,t,n=gi()){const r=await gc(e,Gr(lo(t.bundledQuery))),i=_(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=As(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ti.saveNamedQuery(e,t);const o=r.withResumeToken(gn.EMPTY_BYTE_STRING,s);return i.Fs=i.Fs.insert(o.targetId,o),i.hi.updateTargetData(e,o).next(()=>i.hi.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.hi.addMatchingKeys(e,n,r.targetId)).next(()=>i.Ti.saveNamedQuery(e,t))})}const _c="firestore_clients";function Ec(e,t){return`${_c}_${e}_${t}`}const Tc="firestore_mutations";function Sc(e,t,n){let r=`${Tc}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}const Cc="firestore_targets";function Dc(e,t){return`${Cc}_${e}_${t}`}const Ac="SharedClientState";class xc{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ks(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new T(r.error.code,r.error.message))),s?new xc(e,t,r.state,i):(m(Ac,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ks(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new T(n.error.code,n.error.message))),i?new kc(e,n.state,r):(m(Ac,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Nc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=yi();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=ze(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new Nc(e,i):(m(Ac,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Oc{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Oc(t.clientId,t.onlineState):(m(Ac,`Failed to parse online state: ${e}`),null)}}class Pc{constructor(){this.activeTargetIds=yi()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Lc{constructor(e,t,n,r,i){this.window=e,this.Fi=t,this.persistenceKey=n,this.js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new an(F),this.started=!1,this.Zs=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=Ec(this.persistenceKey,this.js),this.eo=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Pc),this.no=new RegExp(`^${_c}_${s}_([^_]*)$`),this.ro=new RegExp(`^${Tc}_${s}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Cc}_${s}_(\\d+)$`),this.so=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.oo=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ps();for(const t of e){if(t===this.js)continue;const e=this.getItem(Ec(this.persistenceKey,t));if(e){const n=Nc.Ks(t,e);n&&(this.Ys=this.Ys.insert(n.clientId,n))}}this._o();const t=this.storage.getItem(this.so);if(t){const e=this.ao(t);e&&this.uo(e)}for(const e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,n){this.lo(e,t,n),this.ho(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(Dc(this.persistenceKey,e));if(t){const r=kc.Ks(e,t);r&&(n=r.state)}}return t&&this.Po.Gs(e),this._o(),n}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Dc(this.persistenceKey,e))}updateQueryState(e,t,n){this.To(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ho(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return g(Ac,"READ",e,t),t}setItem(e,t){g(Ac,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){g(Ac,"REMOVE",e),this.storage.removeItem(e)}Hs(e){const t=e;if(t.storageArea===this.storage){if(g(Ac,"EVENT",t.key,t.newValue),t.key===this.Xs)return void m("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(null!==t.key)if(this.no.test(t.key)){if(null==t.newValue){const e=this.Ao(t.key);return this.Ro(e,null)}{const e=this.Vo(t.key,t.newValue);if(e)return this.Ro(e.clientId,e)}}else if(this.ro.test(t.key)){if(null!==t.newValue){const e=this.mo(t.key,t.newValue);if(e)return this.fo(e)}}else if(this.io.test(t.key)){if(null!==t.newValue){const e=this.po(t.key,t.newValue);if(e)return this.yo(e)}}else if(t.key===this.so){if(null!==t.newValue){const e=this.ao(t.newValue);if(e)return this.uo(e)}}else if(t.key===this.eo){const e=function(e){let t=je.ue;if(null!=e)try{const n=JSON.parse(e);I("number"==typeof n,30636,{wo:e}),t=n}catch(e){m(Ac,"Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==je.ue&&this.sequenceNumberHandler(e)}else if(t.key===this.oo){const e=this.So(t.newValue);await Promise.all(e.map(e=>this.syncEngine.bo(e)))}}else this.Zs.push(t)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,n){const r=new xc(this.currentUser,e,t,n),i=Sc(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}ho(e){const t=Sc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){const t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,n){const r=Dc(this.persistenceKey,e),i=new kc(e,t,n);this.setItem(r,i.Ws())}Eo(e){const t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){const t=this.no.exec(e);return t?t[1]:null}Vo(e,t){const n=this.Ao(e);return Nc.Ks(n,t)}mo(e,t){const n=this.ro.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return xc.Ks(new h(i),r,t)}po(e,t){const n=this.io.exec(e),r=Number(n[1]);return kc.Ks(r,t)}ao(e){return Oc.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);g(Ac,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){const n=t?this.Ys.insert(e,t):this.Ys.remove(e),r=this.co(this.Ys),i=this.co(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Co(s,o).then(()=>{this.Ys=n})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=yi();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class Mc{constructor(){this.Fo=new Pc,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Pc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Rc{xo(e){}shutdown(){}}const Fc="ConnectivityMonitor";class Vc{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){g(Fc,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){g(Fc,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let jc=null;function Bc(){return null===jc?jc=268435456+Math.round(2147483648*Math.random()):jc++,"0x"+jc.toString(16)}const Uc="RestConnection",qc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zc{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.Ko=this.databaseId.database===An?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){const s=Bc(),a=this.Go(e,t.toUriEncodedString());g(Uc,`Sending RPC '${e}' ${s}:`,a,n);const c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,r,i);const{host:u}=new URL(a),l=o.isCloudWorkstation(u);return this.jo(e,a,c,n,l).then(t=>(g(Uc,`Received RPC '${e}' ${s}: `,t),t),t=>{throw y(Uc,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}zo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+d,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Go(e,t){const n=qc[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}}class $c{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Kc="WebChannelConnection";class Gc extends zc{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,r,i){const s=Bc();return new Promise((i,o)=>{const a=new c.XhrIo;a.setWithCredentials(!0),a.listenOnce(c.EventType.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case c.ErrorCode.NO_ERROR:const t=a.getResponseJson();g(Kc,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.ErrorCode.TIMEOUT:g(Kc,`RPC '${e}' ${s} timed out`),o(new T(E.DEADLINE_EXCEEDED,"Request time out"));break;case c.ErrorCode.HTTP_ERROR:const n=a.getStatus();if(g(Kc,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(t)>=0?t:E.UNKNOWN}(t.status);o(new T(e,t.message))}else o(new T(E.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new T(E.UNAVAILABLE,"Connection failed."));break;default:w(9055,{c_:e,streamId:s,l_:a.getLastErrorCode(),h_:a.getLastError()})}}finally{g(Kc,`RPC '${e}' ${s} completed.`)}});const u=JSON.stringify(r);g(Kc,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",u,n,15)})}P_(e,t,n){const r=Bc(),i=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=c.createWebChannelTransport(),o=c.getStatEventTarget(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(a.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(a.useFetchStreams=!0),this.zo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=i.join("");g(Kc,`Creating RPC '${e}' stream ${r}: ${l}`,a);const h=s.createWebChannel(l,a);this.T_(h);let d=!1,f=!1;const p=new $c({Ho:t=>{f?g(Kc,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(g(Kc,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),g(Kc,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Yo:()=>h.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(h,c.WebChannel.EventType.OPEN,()=>{f||(g(Kc,`RPC '${e}' stream ${r} transport opened.`),p.s_())}),m(h,c.WebChannel.EventType.CLOSE,()=>{f||(f=!0,g(Kc,`RPC '${e}' stream ${r} transport closed`),p.__(),this.I_(h))}),m(h,c.WebChannel.EventType.ERROR,t=>{f||(f=!0,y(Kc,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),p.__(new T(E.UNAVAILABLE,"The operation could not be completed")))}),m(h,c.WebChannel.EventType.MESSAGE,t=>{var n;if(!f){const i=t.data[0];I(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){g(Kc,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=ts[e];if(void 0!==t)return is(t)}(t),i=o.message;void 0===n&&(n=E.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,p.__(new T(n,i)),h.close()}else g(Kc,`RPC '${e}' stream ${r} received:`,i),p.a_(i)}}),m(o,c.Event.STAT_EVENT,t=>{t.stat===c.Stat.PROXY?g(Kc,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===c.Stat.NOPROXY&&g(Kc,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.o_()},0),p}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Wc(){return"undefined"!=typeof window?window:null}function Hc(){return"undefined"!=typeof document?document:null}function Qc(e){return new Es(e,!0)}class Xc{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=r,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),r=Math.max(0,t-n);r>0&&g("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,r,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const Jc="PersistentStream";class Yc{constructor(e,t,n,r,i,s,o,a){this.Fi=e,this.w_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Xc(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(m(t.toString()),m("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===E.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.b_===t&&this.W_(e,n)},t=>{e(()=>{const e=new T(E.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){const n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{n(()=>this.G_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return g(Jc,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(g(Jc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zc extends Yc{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:w(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(I(void 0===t||"string"==typeof t,58123),gn.fromBase64String(t||"")):(I(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),gn.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?E.UNKNOWN:is(e.code);return new T(t,e.message||"")}(o);n=new gs(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ps(e,r.document.name),s=As(r.document.updateTime),o=r.document.createTime?As(r.document.createTime):ce.min(),a=new sr({mapValue:{fields:r.document.fields}}),c=ar.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new fs(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ps(e,r.document),s=r.readTime?As(r.readTime):ce.min(),o=ar.newNoDocument(i,s),a=r.removedTargetIds||[];n=new fs([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ps(e,r.document),s=r.removedTargetIds||[];n=new fs([],s,i,null)}else{if(!("filter"in t))return w(11601,{At:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new es(r,i),o=e.targetId;n=new ps(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ce.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ce.min():t.readTime?As(t.readTime):ce.min()}(e);return this.listener.J_(t,n)}H_(e){const t={};t.database=Rs(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Rr(r)?{documents:qs(e,r)}:{query:zs(e,r).Vt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Cs(e,t.resumeToken);const r=Ts(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ce.min())>0){n.readTime=Ss(e,t.snapshotVersion.toTimestamp());const r=Ts(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return w(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.k_(t)}Y_(e){const t={};t.database=Rs(this.serializer),t.removeTarget=e,this.k_(t)}}class eu extends Yc{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return I(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,I(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){I(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=function(e,t){return e&&e.length>0?(I(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?As(e.updateTime):As(t);return n.isEqual(ce.min())&&(n=As(t)),new Li(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=As(e.commitTime);return this.listener.ta(n,t)}na(){const e={};e.database=Rs(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Bs(this.serializer,e))};this.k_(t)}}class tu{}class nu extends tu{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ra=!1}ia(){if(this.ra)throw new T(E.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,ks(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(E.UNKNOWN,e.toString())})}Jo(e,t,n,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Jo(e,ks(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(E.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class ru{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(m(t),this._a=!1):g("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const iu="RemoteStore";class su{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(e=>{n.enqueueAndForget(async()=>{pu(this)&&(g(iu,"Restarting streams for network reachability change."),await async function(e){const t=_(e);t.Ia.add(4),await au(t),t.Aa.set("Unknown"),t.Ia.delete(4),await ou(t)}(this))})}),this.Aa=new ru(n,r)}}async function ou(e){if(pu(e))for(const t of e.da)await t(!0)}async function au(e){for(const t of e.da)await t(!1)}function cu(e,t){const n=_(e);n.Ta.has(t.targetId)||(n.Ta.set(t.targetId,t),fu(n)?du(n):Pu(n).x_()&&lu(n,t))}function uu(e,t){const n=_(e),r=Pu(n);n.Ta.delete(t),r.x_()&&hu(n,t),0===n.Ta.size&&(r.x_()?r.B_():pu(n)&&n.Aa.set("Unknown"))}function lu(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ce.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Pu(e).H_(t)}function hu(e,t){e.Ra.$e(t),Pu(e).Y_(t)}function du(e){e.Ra=new ys({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),Pu(e).start(),e.Aa.aa()}function fu(e){return pu(e)&&!Pu(e).M_()&&e.Ta.size>0}function pu(e){return 0===_(e).Ia.size}function gu(e){e.Ra=void 0}async function mu(e){e.Aa.set("Online")}async function yu(e){e.Ta.forEach((t,n)=>{lu(e,t)})}async function vu(e,t){gu(e),fu(e)?(e.Aa.la(t),du(e)):e.Aa.set("Unknown")}async function wu(e,t,n){if(e.Aa.set("Online"),t instanceof gs&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ta.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ta.delete(r),e.Ra.removeTarget(r))}(e,t)}catch(n){g(iu,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await bu(e,n)}else if(t instanceof fs?e.Ra.Ye(t):t instanceof ps?e.Ra.it(t):e.Ra.et(t),!n.isEqual(ce.min()))try{const t=await dc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Ra.Pt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ta.get(r);i&&e.Ta.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ta.get(t);if(!r)return;e.Ta.set(t,r.withResumeToken(gn.EMPTY_BYTE_STRING,r.snapshotVersion)),hu(e,t);const i=new to(r.target,t,n,r.sequenceNumber);lu(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){g(iu,"Failed to raise snapshot:",t),await bu(e,t)}}async function bu(e,t,n){if(!Ne(t))throw t;e.Ia.add(1),await au(e),e.Aa.set("Offline"),n||(n=()=>dc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{g(iu,"Retrying IndexedDB access"),await n(),e.Ia.delete(1),await ou(e)})}function Iu(e,t){return t().catch(n=>bu(e,n,t))}async function _u(e){const t=_(e),n=Lu(t);let r=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:Be;for(;Eu(t);)try{const e=await pc(t.localStore,r);if(null===e){0===t.Pa.length&&n.B_();break}r=e.batchId,Tu(t,e)}catch(e){await bu(t,e)}Su(t)&&Cu(t)}function Eu(e){return pu(e)&&e.Pa.length<10}function Tu(e,t){e.Pa.push(t);const n=Lu(e);n.x_()&&n.Z_&&n.X_(t.mutations)}function Su(e){return pu(e)&&!Lu(e).M_()&&e.Pa.length>0}function Cu(e){Lu(e).start()}async function Du(e){Lu(e).na()}async function Au(e){const t=Lu(e);for(const n of e.Pa)t.X_(n.mutations)}async function xu(e,t,n){const r=e.Pa.shift(),i=Ji.from(r,t,n);await Iu(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await _u(e)}async function ku(e,t){t&&Lu(e).Z_&&await async function(e,t){if(function(e){return rs(e)&&e!==E.ABORTED}(t.code)){const n=e.Pa.shift();Lu(e).N_(),await Iu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await _u(e)}}(e,t),Su(e)&&Cu(e)}async function Nu(e,t){const n=_(e);n.asyncQueue.verifyOperationInProgress(),g(iu,"RemoteStore received new credentials");const r=pu(n);n.Ia.add(3),await au(n),r&&n.Aa.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ia.delete(3),await ou(n)}async function Ou(e,t){const n=_(e);t?(n.Ia.delete(2),await ou(n)):t||(n.Ia.add(2),await au(n),n.Aa.set("Unknown"))}function Pu(e){return e.Va||(e.Va=function(e,t,n){const r=_(e);return r.ia(),new Zc(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:mu.bind(null,e),e_:yu.bind(null,e),n_:vu.bind(null,e),J_:wu.bind(null,e)}),e.da.push(async t=>{t?(e.Va.N_(),fu(e)?du(e):e.Aa.set("Unknown")):(await e.Va.stop(),gu(e))})),e.Va}function Lu(e){return e.ma||(e.ma=function(e,t,n){const r=_(e);return r.ia(),new eu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),e_:Du.bind(null,e),n_:ku.bind(null,e),ea:Au.bind(null,e),ta:xu.bind(null,e)}),e.da.push(async t=>{t?(e.ma.N_(),await _u(e)):(await e.ma.stop(),e.Pa.length>0&&(g(iu,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))})),e.ma}class Mu{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new S,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Mu(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new T(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ru(e,t){if(m("AsyncQueue",`${t}: ${e}`),Ne(e))return new T(E.UNAVAILABLE,`${t}: ${e}`);throw e}class Fu{static emptySet(e){return new Fu(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||H.comparator(t.key,n.key):(e,t)=>H.comparator(e.key,t.key),this.keyedMap=ci(),this.sortedSet=new an(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Fu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Vu{constructor(){this.fa=new an(H.comparator)}track(e){const t=e.doc.key,n=this.fa.get(t);n?0!==e.type&&3===n.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.fa=this.fa.remove(t):1===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):w(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}}class ju{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ju(e,t,Fu.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Bu{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class Uu{constructor(){this.queries=qu(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){const n=_(e),r=n.queries;n.queries=qu(),r.forEach((e,n)=>{for(const e of n.wa)e.onError(t)})}(this,new T(E.ABORTED,"Firestore shutting down"))}}function qu(){return new ii(e=>Yr(e),Jr)}async function zu(e,t){const n=_(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.Sa()&&t.ba()&&(r=2):(s=new Bu,r=t.ba()?0:1);try{switch(r){case 0:s.ya=await n.onListen(i,!0);break;case 1:s.ya=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Ru(e,`Initialization of query '${Zr(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.wa.push(t),t.va(n.onlineState),s.ya&&t.Ca(s.ya)&&Wu(n)}async function $u(e,t){const n=_(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.wa.indexOf(t);e>=0&&(s.wa.splice(e,1),0===s.wa.length?i=t.ba()?0:1:!s.Sa()&&t.ba()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ku(e,t){const n=_(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.wa)t.Ca(e)&&(r=!0);i.ya=e}}r&&Wu(n)}function Gu(e,t,n){const r=_(e),i=r.queries.get(t);if(i)for(const e of i.wa)e.onError(n);r.queries.delete(t)}function Wu(e){e.Da.forEach(e=>{e.next()})}var Hu,Qu;(Qu=Hu||(Hu={})).Fa="default",Qu.Cache="cache";class Xu{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ju(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const n="Offline"!==t;return(!this.options.ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=ju.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Hu.Cache}}class Ju{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}}class Yu{constructor(e){this.serializer=e}Qs(e){return Ps(this.serializer,e)}$s(e){return e.metadata.exists?js(this.serializer,e.document,!1):ar.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return As(e)}}class Zu{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=el(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;const n=K.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){const t=new Map,n=new Yu(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Qs(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||gi()).add(e);t.set(n,r)}}return t}async za(e){const t=await async function(e,t,n,r){const i=_(e);let s=gi(),o=oi();for(const e of n){const n=t.Qs(e.metadata.name);e.document&&(s=s.add(n));const r=t.$s(e);r.setReadTime(t.Us(e.metadata.readTime)),o=o.insert(n,r)}const a=i.Os.newChangeBuffer({trackRemovals:!0}),c=await gc(i,function(e){return Gr(qr(K.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>fc(e,a,o).next(t=>(a.apply(e),t)).next(t=>i.hi.removeMatchingKeysForTargetId(e,c.targetId).next(()=>i.hi.addMatchingKeys(e,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.Ls,t.ks)).next(()=>t.Ls)))}(e,new Yu(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(const t of this.Ua)await Ic(e,t,n.get(t.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}}}function el(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class tl{constructor(e){this.key=e}}class nl{constructor(e){this.key=e}}class rl{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=gi(),this.mutatedKeys=gi(),this.Xa=ni(e),this.eu=new Fu(this.Xa)}get tu(){return this.Ha}nu(e,t){const n=t?t.ru:new Vu,r=t?t.eu:this.eu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),l=ei(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.iu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Xa(l,a)>0||c&&this.Xa(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{eu:s,ru:n,Ds:o,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const s=e.ru.pa();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return w(20277,{At:e})}};return n(e)-n(t)}(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(n),r=null!=r&&r;const o=t&&!r?this.ou():[],a=0===this.Za.size&&this.current&&!r?1:0,c=a!==this.Ya;return this.Ya=a,0!==s.length||c?{snapshot:new ju(this.query,e.eu,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:o}:{_u:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Vu,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=gi(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});const t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new nl(e))}),this.Za.forEach(n=>{e.has(n)||t.push(new tl(n))}),t}uu(e){this.Ha=e.qs,this.Za=gi();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ju.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const il="SyncEngine";class sl{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ol{constructor(e){this.key=e,this.lu=!1}}class al{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.hu={},this.Pu=new ii(e=>Yr(e),Jr),this.Tu=new Map,this.Iu=new Set,this.du=new an(H.comparator),this.Eu=new Map,this.Au=new Va,this.Ru={},this.Vu=new Map,this.mu=la.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function cl(e,t,n=!0){const r=Fl(e);let i;const s=r.Pu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await ll(r,t,n,!0),i}async function ul(e,t){const n=Fl(e);await ll(n,t,!0,!1)}async function ll(e,t,n,r){const i=await gc(e.localStore,Gr(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await hl(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&cu(e.remoteStore,i),a}async function hl(e,t,n,r,i){e.gu=(t,n,r)=>async function(e,t,n,r){let i=t.view.nu(n);i.Ds&&(i=await yc(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return El(e,t.targetId,a._u),a.snapshot}(e,t,n,r);const s=await yc(e.localStore,t,!0),o=new rl(t,s.qs),a=o.nu(s.documents),c=ds.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);El(e,n,u._u);const l=new sl(t,n,o);return e.Pu.set(t,l),e.Tu.has(n)?e.Tu.get(n).push(t):e.Tu.set(n,[t]),u.snapshot}async function dl(e,t,n){const r=_(e),i=r.Pu.get(t),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(e=>!Jr(e,t))),void r.Pu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await mc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&uu(r.remoteStore,i.targetId),Il(r,i.targetId)}).catch(Ee)):(Il(r,i.targetId),await mc(r.localStore,i.targetId,!0))}async function fl(e,t){const n=_(e),r=n.Pu.get(t),i=n.Tu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),uu(n.remoteStore,r.targetId))}async function pl(e,t){const n=_(e);try{const e=await function(e,t){const n=_(e),r=t.snapshotVersion;let i=n.Fs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Os.newChangeBuffer({trackRemovals:!0});i=n.Fs;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.hi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.hi.addMatchingKeys(e,s.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(gn.EMPTY_BYTE_STRING,ce.min()).withLastLimboFreeSnapshotVersion(ce.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.hi.updateTargetData(e,u))});let a=oi(),c=gi();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(fc(e,s,t.documentUpdates).next(e=>{a=e.Ls,c=e.ks})),!r.isEqual(ce.min())){const t=n.hi.getLastRemoteSnapshotVersion(e).next(t=>n.hi.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return Te.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Fs=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Eu.get(t);r&&(I(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.lu=!0:e.modifiedDocuments.size>0?I(r.lu,14607):e.removedDocuments.size>0&&(I(r.lu,42227),r.lu=!1))}),await Cl(n,e,t)}catch(e){await Ee(e)}}function gl(e,t,n){const r=_(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Pu.forEach((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=_(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const e of n.wa)e.va(t)&&(r=!0)}),r&&Wu(n)}(r.eventManager,t),e.length&&r.hu.J_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function ml(e,t,n){const r=_(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Eu.get(t),s=i&&i.key;if(s){let e=new an(H.comparator);e=e.insert(s,ar.newNoDocument(s,ce.min()));const n=gi().add(s),i=new hs(ce.min(),new Map,new an(F),e,n);await pl(r,i),r.du=r.du.remove(s),r.Eu.delete(t),Sl(r)}else await mc(r.localStore,t,!1).then(()=>Il(r,t,n)).catch(Ee)}async function yl(e,t){const n=_(e),r=t.batch.batchId;try{const e=await function(e,t){const n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Te.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);I(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=gi();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);bl(n,r,null),wl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Cl(n,e)}catch(e){await Ee(e)}}async function vl(e,t,n){const r=_(e);try{const e=await function(e,t){const n=_(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(I(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);bl(r,t,n),wl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Cl(r,e)}catch(n){await Ee(n)}}function wl(e,t){(e.Vu.get(t)||[]).forEach(e=>{e.resolve()}),e.Vu.delete(t)}function bl(e,t,n){const r=_(e);let i=r.Ru[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ru[r.currentUser.toKey()]=i}}function Il(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Tu.get(t))e.Pu.delete(r),n&&e.hu.pu(r,n);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||_l(e,t)})}function _l(e,t){e.Iu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(uu(e.remoteStore,n),e.du=e.du.remove(t),e.Eu.delete(n),Sl(e))}function El(e,t,n){for(const r of n)r instanceof tl?(e.Au.addReference(r.key,t),Tl(e,r)):r instanceof nl?(g(il,"Document no longer in limbo: "+r.key),e.Au.removeReference(r.key,t),e.Au.containsKey(r.key)||_l(e,r.key)):w(19791,{yu:r})}function Tl(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Iu.has(r)||(g(il,"New document in limbo: "+n),e.Iu.add(r),Sl(e))}function Sl(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const n=new H(K.fromString(t)),r=e.mu.next();e.Eu.set(r,new ol(n)),e.du=e.du.insert(n,r),cu(e.remoteStore,new to(Gr(qr(n.path)),r,"TargetPurposeLimboResolution",je.ue))}}async function Cl(e,t,n){const r=_(e),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((e,a)=>{o.push(r.gu(a,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=sc.Es(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.hu.J_(i),await async function(e,t){const n=_(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Te.forEach(t,t=>Te.forEach(t.Is,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Te.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Ne(e))throw e;g(cc,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Fs.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Fs=n.Fs.insert(t,i)}}}(r.localStore,s))}async function Dl(e,t){const n=_(e);if(!n.currentUser.isEqual(t)){g(il,"User change. New user:",t.toKey());const e=await hc(n.localStore,t);n.currentUser=t,function(e){e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new T(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Cl(n,e.Bs)}}function Al(e,t){const n=_(e),r=n.Eu.get(t);if(r&&r.lu)return gi().add(r.key);{let e=gi();const r=n.Tu.get(t);if(!r)return e;for(const t of r){const r=n.Pu.get(t);e=e.unionWith(r.view.tu)}return e}}async function xl(e,t){const n=_(e),r=await yc(n.localStore,t.query,!0),i=t.view.uu(r);return n.isPrimaryClient&&El(n,t.targetId,i._u),i}async function kl(e,t){const n=_(e);return wc(n.localStore,t).then(e=>Cl(n,e))}async function Nl(e,t,n,r){const i=_(e),s=await function(e,t){const n=_(e),r=_(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.Xn(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):Te.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await _u(i.remoteStore):"acknowledged"===n||"rejected"===n?(bl(i,t,r||null),wl(i,t),function(e,t){_(_(e).mutationQueue).rr(t)}(i.localStore,t)):w(6720,"Unknown batchState",{wu:n}),await Cl(i,s)):g(il,"Cannot apply mutation batch with id: "+t)}async function Ol(e,t,n){const r=_(e),i=[],s=[];for(const e of t){let t;const n=r.Tu.get(e);if(n&&0!==n.length){t=await gc(r.localStore,Gr(n[0]));for(const e of n){const t=r.Pu.get(e),n=await xl(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await vc(r.localStore,e);t=await gc(r.localStore,n),await hl(r,Pl(n),e,!1,t.resumeToken)}i.push(t)}return r.hu.J_(s),i}function Pl(e){return Ur(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Ll(e){return function(e){return _(_(e).persistence).Ps()}(_(e).localStore)}async function Ml(e,t,n,r){const i=_(e);if(i.fu)return void g(il,"Ignoring unexpected query state notification.");const s=i.Tu.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await wc(i.localStore,ti(s[0])),r=hs.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,gn.EMPTY_BYTE_STRING);await Cl(i,e,r);break}case"rejected":await mc(i.localStore,t,!0),Il(i,t,r);break;default:w(64155,n)}}async function Rl(e,t,n){const r=Fl(e);if(r.fu){for(const e of t){if(r.Tu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){g(il,"Adding an already active target "+e);continue}const t=await vc(r.localStore,e),n=await gc(r.localStore,t);await hl(r,Pl(t),n.targetId,!1,n.resumeToken),cu(r.remoteStore,n)}for(const e of n)r.Tu.has(e)&&await mc(r.localStore,e,!1).then(()=>{uu(r.remoteStore,e),Il(r,e)}).catch(Ee)}}function Fl(e){const t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=pl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Al.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ml.bind(null,t),t.hu.J_=Ku.bind(null,t.eventManager),t.hu.pu=Gu.bind(null,t.eventManager),t}function Vl(e){const t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=yl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=vl.bind(null,t),t}class jl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Qc(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return lc(this.persistence,new ac,e.initialUser,this.serializer)}Du(e){return new $a(Ga.Vi,this.serializer)}bu(e){return new Mc}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jl.provider={build:()=>new jl};class Bl extends jl{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){I(this.persistence.referenceDelegate instanceof Wa,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new wa(n,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?na.withCacheSize(this.cacheSizeBytes):na.DEFAULT;return new $a(e=>Wa.Vi(e,t),this.serializer)}}class Ul extends jl{constructor(e,t,n){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await Vl(this.Mu.syncEngine),await _u(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return lc(this.persistence,new ac,e.initialUser,this.serializer)}Cu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new wa(n,e.asyncQueue,t)}Fu(e,t){const n=new Ve(t,this.persistence);return new Fe(e.asyncQueue,n)}Du(e){const t=ic(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?na.withCacheSize(this.cacheSizeBytes):na.DEFAULT;return new tc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Wc(),Hc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Mc}}class ql extends Ul{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Mu.syncEngine;this.sharedClientState instanceof Lc&&(this.sharedClientState.syncEngine={Do:Nl.bind(null,t),vo:Ml.bind(null,t),Co:Rl.bind(null,t),Ps:Ll.bind(null,t),bo:kl.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async e=>{await async function(e,t){const n=_(e);if(Fl(n),Vl(n),!0===t&&!0!==n.fu){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Ol(n,e.toArray());n.fu=!0,await Ou(n.remoteStore,!0);for(const e of t)cu(n.remoteStore,e)}else if(!1===t&&!1!==n.fu){const e=[];let t=Promise.resolve();n.Tu.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(Il(n,i),mc(n.localStore,i,!0))),uu(n.remoteStore,i)}),await t,await Ol(n,e),function(e){const t=_(e);t.Eu.forEach((e,n)=>{uu(t.remoteStore,n)}),t.Au.jr(),t.Eu=new Map,t.du=new an(H.comparator)}(n),n.fu=!1,await Ou(n.remoteStore,!1)}}(this.Mu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}bu(e){const t=Wc();if(!Lc.C(t))throw new T(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=ic(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Lc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class zl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>gl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Dl.bind(null,this.syncEngine),await Ou(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Uu}createDatastore(e){const t=Qc(e.databaseInfo.databaseId),n=function(e){return new Gc(e)}(e.databaseInfo);return function(e,t,n,r){return new nu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new su(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>gl(this.syncEngine,e,0),Vc.C()?new Vc:new Rc)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new al(e,t,n,r,i,s);return o&&(a.fu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=_(e);g(iu,"RemoteStore shutting down."),t.Ia.add(5),await au(t),t.Ea.shutdown(),t.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}function $l(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}zl.provider={build:()=>new zl};class Kl{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):m("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Gl{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new S,this.buffer=new Uint8Array,this.Bu=new TextDecoder("utf-8"),this.Lu().then(e=>{e&&e.Qa()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){const e=await this.ku();if(null===e)return null;const t=this.Bu.decode(e),n=Number(t);isNaN(n)&&this.qu(`length string (${t}) is not valid number`);const r=await this.Qu(n);return new Ju(JSON.parse(r),e.length+n)}$u(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async ku(){for(;this.$u()<0&&!await this.Uu(););if(0===this.buffer.length)return null;const e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Qu(e){for(;this.buffer.length<e;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");const t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Uu(){const e=await this.Nu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Wl{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is\n         ${JSON.stringify(null==n?void 0:n.qa)}`);this.metadata=n;do{n=this.Su(),null!==n&&this.elements.push(n)}while(null!==n)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;const e=this.ku(),t=this.Qu(e);return new Ju(JSON.parse(t),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new T(E.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}class Hl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new T(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=_(e),r={documents:t.map(e=>Os(n.serializer,e))},i=await n.Jo("BatchGetDocuments",n.serializer.databaseId,K.emptyPath(),r,t.length),s=new Map;i.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){I(!!t.found,43571),t.found.name,t.found.updateTime;const n=Ps(e,t.found.name),r=As(t.found.updateTime),i=t.found.createTime?As(t.found.createTime):ce.min(),s=new sr({mapValue:{fields:t.found.fields}});return ar.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){I(!!t.missing,3894),I(!!t.readTime,22933);const n=Ps(e,t.missing),r=As(t.readTime);return ar.newNoDocument(n,r)}(e,t):w(7234,{result:t})}(n.serializer,e);s.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{const t=s.get(e.toString());I(!!t,55234,{key:e}),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=H.fromPath(t);this.mutations.push(new Qi(n,this.precondition(n)))}),await async function(e,t){const n=_(e),r={writes:t.map(e=>Bs(n.serializer,e))};await n.Wo("Commit",n.serializer.databaseId,K.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw w(50498,{Wu:e.constructor.name});t=ce.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new T(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ce.min())?Mi.exists(!1):Mi.updateTime(t):Mi.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ce.min()))throw new T(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Mi.updateTime(t)}return Mi.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Ql{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Gu=n.maxAttempts,this.F_=new Xc(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{const e=new Hl(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Hu(e)}))}).catch(e=>{this.Hu(e)})})}Ju(e){try{const t=this.updateFunction(e);return!Ue(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!rs(t)}return!1}}const Xl="FirestoreClient";class Jl{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=h.UNAUTHENTICATED,this.clientId=R.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{g(Xl,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(g(Xl,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new S;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Ru(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Yl(e,t){e.asyncQueue.verifyOperationInProgress(),g(Xl,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await hc(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>{y("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{g("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{y("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function Zl(e,t){e.asyncQueue.verifyOperationInProgress();const n=await eh(e);g(Xl,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Nu(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Nu(t.remoteStore,n)),e._onlineComponents=t}async function eh(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){g(Xl,"Using user provided OfflineComponentProvider");try{await Yl(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===E.FAILED_PRECONDITION||e.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;y("Error using user provided cache. Falling back to memory cache: "+n),await Yl(e,new jl)}}else g(Xl,"Using default OfflineComponentProvider"),await Yl(e,new Bl(void 0));return e._offlineComponents}async function th(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(g(Xl,"Using user provided OnlineComponentProvider"),await Zl(e,e._uninitializedComponentsProvider._online)):(g(Xl,"Using default OnlineComponentProvider"),await Zl(e,new zl))),e._onlineComponents}function nh(e){return eh(e).then(e=>e.persistence)}function rh(e){return eh(e).then(e=>e.localStore)}function ih(e){return th(e).then(e=>e.remoteStore)}function sh(e){return th(e).then(e=>e.syncEngine)}function oh(e){return th(e).then(e=>e.datastore)}async function ah(e){const t=await th(e),n=t.eventManager;return n.onListen=cl.bind(null,t.syncEngine),n.onUnlisten=dl.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ul.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fl.bind(null,t.syncEngine),n}function ch(e,t,n={}){const r=new S;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Kl({next:a=>{s.Ou(),t.enqueueAndForget(()=>$u(e,o));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new T(E.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Xu(qr(n.path),s,{includeMetadataChanges:!0,ka:!0});return zu(e,o)}(await ah(e),e.asyncQueue,t,n,r)),r.promise}function uh(e,t,n={}){const r=new S;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Kl({next:n=>{s.Ou(),t.enqueueAndForget(()=>$u(e,o)),n.fromCache&&"server"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Xu(n,s,{includeMetadataChanges:!0,ka:!0});return zu(e,o)}(await ah(e),e.asyncQueue,t,n,r)),r.promise}function lh(e,t){return function(e,t){return new Wl(e,t)}(e,t)}function hh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const dh=new Map,fh="firestore.googleapis.com",ph=!0;class gh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new T(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fh,this.ssl=ph}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:ph;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=ta;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<ma)throw new T(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}X("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new T(E.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new T(E.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new T(E.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mh{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gh({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new T(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new T(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gh(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new D;switch(e.type){case"firstParty":return new N(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new T(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=dh.get(e);t&&(g("ComponentProvider","Removing Datastore"),dh.delete(e),t.terminate())}(this),Promise.resolve()}}function yh(e,t,n,r={}){var i;e=te(e,mh);const s=o.isCloudWorkstation(t),a=e._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),u=`${t}:${n}`;s&&(o.pingServer(`https://${u}`),o.updateEmulatorBanner("Firestore",!0)),a.host!==fh&&a.host!==u&&y("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},a),{host:u,ssl:s,emulatorOptions:r});if(!o.deepEqual(l,c)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=h.MOCK_USER;else{t=o.createMockUserToken(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new T(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new h(s)}e._authCredentials=new A(new C(t,n))}}class vh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new vh(this.firestore,e,this._query)}}class wh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new wh(this.firestore,e,this._key)}toJSON(){return{type:wh._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ie(t,wh._jsonSchema))return new wh(e,n||null,new H(K.fromString(t.referencePath)))}}wh._jsonSchemaVersion="firestore/documentReference/1.0",wh._jsonSchema={type:re("string",wh._jsonSchemaVersion),referencePath:re("string")};class bh extends vh{constructor(e,t,n){super(e,t,qr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new wh(this.firestore,null,new H(e))}withConverter(e){return new bh(this.firestore,e,this._path)}}function Ih(e,t,...n){if(e=o.getModularInstance(e),1===arguments.length&&(t=R.newId()),Q("doc","path",t),e instanceof mh){const r=K.fromString(t,...n);return J(r),new wh(e,null,new H(r))}{if(!(e instanceof wh||e instanceof bh))throw new T(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(K.fromString(t,...n));return J(r),new wh(e.firestore,e instanceof bh?e.converter:null,new H(r))}}function _h(e,t){return e=o.getModularInstance(e),t=o.getModularInstance(t),e instanceof vh&&t instanceof vh&&e.firestore===t.firestore&&Jr(e._query,t._query)&&e.converter===t.converter}const Eh="AsyncQueue";class Th{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Xc(this,"async_queue_retry"),this.oc=()=>{const e=Hc();e&&g(Eh,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=Hc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Hc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new S;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ne(e))throw e;g(Eh,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,m("INTERNAL UNHANDLED ERROR: ",Sh(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const r=Mu.createAndSchedule(this,e,t,n,e=>this.lc(e));return this.ec.push(r),r}ac(){this.tc&&w(47125,{hc:Sh(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Sh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function Ch(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(e)}class Dh{constructor(){this._progressObserver={},this._taskCompletionResolver=new S,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Ah extends mh{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Th,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Th(e),this._firestoreClient=void 0,await e}}}function xh(e){if(e._terminated)throw new T(E.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||kh(e),e._firestoreClient}function kh(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Dn(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,hh(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Jl(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Nh(e,t,n){if((e=te(e,Ah))._firestoreClient||e._terminated)throw new T(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new T(E.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},kh(e)}function Oh(e,t){const n=xh(e=te(e,Ah)),r=new Dh;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?M().encode(e):e,function(e,t){return new Gl(e,t)}(function(e,t){if(e instanceof Uint8Array)return $l(e,t);if(e instanceof ArrayBuffer)return $l(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Qc(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=_(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=_(e),r=As(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ti.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(el(r));const i=new Zu(r,t.serializer);let s=await t.Su();for(;s;){const e=await i.Wa(s);e&&n._updateProgress(e),s=await t.Su()}const o=await i.za(e.localStore);return await Cl(e,o.Ja,void 0),await function(e,t){const n=_(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ti.saveBundleMetadata(e,t))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.ja)}catch(e){return y(il,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await sh(e),i,r)})}(n,e._databaseId,t,r),r}function Ph(e,t){return function(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){const n=_(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Ti.getNamedQuery(e,t))}(await rh(e),t))}(xh(e=te(e,Ah)),t).then(t=>t?new vh(e,null,t.query):null)}class Lh{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Mh{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class Rh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rh(gn.fromBase64String(e))}catch(e){throw new T(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Rh(gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Rh._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ie(e,Rh._jsonSchema))return Rh.fromBase64String(e.bytes)}}Rh._jsonSchemaVersion="firestore/bytes/1.0",Rh._jsonSchema={type:re("string",Rh._jsonSchemaVersion),bytes:re("string")};class Fh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new T(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new W(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Vh{constructor(e){this._methodName=e}}class jh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return F(this._lat,e._lat)||F(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jh._jsonSchemaVersion}}static fromJSON(e){if(ie(e,jh._jsonSchema))return new jh(e.latitude,e.longitude)}}jh._jsonSchemaVersion="firestore/geoPoint/1.0",jh._jsonSchema={type:re("string",jh._jsonSchemaVersion),latitude:re("number"),longitude:re("number")};class Bh{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Bh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ie(e,Bh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Bh(e.vectorValues);throw new T(E.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Bh._jsonSchemaVersion="firestore/vectorValue/1.0",Bh._jsonSchema={type:re("string",Bh._jsonSchemaVersion),vectorValues:re("object")};const Uh=/^__.*__$/;class qh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new $i(e,this.data,this.fieldMask,t,this.fieldTransforms):new zi(e,this.data,t,this.fieldTransforms)}}class zh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new $i(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $h(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw w(40011,{Ec:e})}}class Kh{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Kh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.fc(e),r}gc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.Ac(),r}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return hd(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if($h(this.Ec)&&Uh.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class Gh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qc(e)}Dc(e,t,n,r=!1){return new Kh({Ec:e,methodName:t,bc:n,path:W.emptyPath(),mc:!1,Sc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wh(e){const t=e._freezeSettings(),n=Qc(e._databaseId);return new Gh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Hh(e,t,n,r,i,s={}){const o=e.Dc(s.merge||s.mergeFields?2:0,t,n,i);ad("Data must be an object, but it was:",o,r);const a=sd(r,o);let c,u;if(s.merge)c=new fn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=cd(t,r,n);if(!o.contains(i))throw new T(E.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);dd(e,i)||e.push(i)}c=new fn(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new qh(new sr(a),c,u)}class Qh extends Vh{_toFieldTransform(e){if(2!==e.Ec)throw 1===e.Ec?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Qh}}function Xh(e,t,n){return new Kh({Ec:3,bc:t.settings.bc,methodName:e._methodName,mc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Jh extends Vh{_toFieldTransform(e){return new Pi(e.path,new Si)}isEqual(e){return e instanceof Jh}}class Yh extends Vh{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Xh(this,e,!0),n=this.vc.map(e=>id(e,t)),r=new Ci(n);return new Pi(e.path,r)}isEqual(e){return e instanceof Yh&&o.deepEqual(this.vc,e.vc)}}class Zh extends Vh{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Xh(this,e,!0),n=this.vc.map(e=>id(e,t)),r=new Ai(n);return new Pi(e.path,r)}isEqual(e){return e instanceof Zh&&o.deepEqual(this.vc,e.vc)}}class ed extends Vh{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){const t=new ki(e.serializer,bi(e.serializer,this.Cc));return new Pi(e.path,t)}isEqual(e){return e instanceof ed&&this.Cc===e.Cc}}function td(e,t,n,r){const i=e.Dc(1,t,n);ad("Data must be an object, but it was:",i,r);const s=[],a=sr.empty();rn(r,(e,r)=>{const c=ld(t,e,n);r=o.getModularInstance(r);const u=i.gc(c);if(r instanceof Qh)s.push(c);else{const e=id(r,u);null!=e&&(s.push(c),a.set(c,e))}});const c=new fn(s);return new zh(a,c,i.fieldTransforms)}function nd(e,t,n,r,i,s){const a=e.Dc(1,t,n),c=[cd(t,r,n)],u=[i];if(s.length%2!=0)throw new T(E.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(cd(t,s[e])),u.push(s[e+1]);const l=[],h=sr.empty();for(let e=c.length-1;e>=0;--e)if(!dd(l,c[e])){const t=c[e];let n=u[e];n=o.getModularInstance(n);const r=a.gc(t);if(n instanceof Qh)l.push(t);else{const e=id(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new fn(l);return new zh(h,d,a.fieldTransforms)}function rd(e,t,n,r=!1){return id(n,e.Dc(r?4:3,t))}function id(e,t){if(od(e=o.getModularInstance(e)))return ad("Unsupported field value:",t,e),sd(e,t);if(e instanceof Vh)return function(e,t){if(!$h(t.Ec))throw t.wc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.wc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.mc&&4!==t.Ec)throw t.wc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=id(i,t.yc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=o.getModularInstance(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return bi(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ae.fromDate(e);return{timestampValue:Ss(t.serializer,n)}}if(e instanceof ae){const n=new ae(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ss(t.serializer,n)}}if(e instanceof jh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Rh)return{bytesValue:Cs(t.serializer,e._byteString)};if(e instanceof wh){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.wc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:xs(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Bh)return function(e,t){return{mapValue:{fields:{[kn]:{stringValue:Pn},[Ln]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.wc("VectorValues must only contain numeric values.");return vi(t.serializer,e)})}}}}}}(e,t);throw t.wc(`Unsupported field value: ${ee(e)}`)}(e,t)}function sd(e,t){const n={};return on(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):rn(e,(e,r)=>{const i=id(r,t.Vc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function od(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ae||e instanceof jh||e instanceof Rh||e instanceof wh||e instanceof Vh||e instanceof Bh)}function ad(e,t,n){if(!od(n)||!Z(n)){const r=ee(n);throw"an object"===r?t.wc(e+" a custom object"):t.wc(e+" "+r)}}function cd(e,t,n){if((t=o.getModularInstance(t))instanceof Fh)return t._internalPath;if("string"==typeof t)return ld(e,t);throw hd("Field path arguments must be of type string or ",e,!1,void 0,n)}const ud=new RegExp("[~\\*/\\[\\]]");function ld(e,t,n){if(t.search(ud)>=0)throw hd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Fh(...t.split("."))._internalPath}catch(r){throw hd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function hd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new T(E.INVALID_ARGUMENT,a+e+c)}function dd(e,t){return e.some(e=>e.isEqual(t))}class fd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new wh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new pd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(gd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class pd extends fd{data(){return super.data()}}function gd(e,t){return"string"==typeof t?ld(e,t):t instanceof Fh?t._internalPath:t._delegate._internalPath}function md(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new T(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yd{}class vd extends yd{}class wd extends vd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new wd(e,t,n)}_apply(e){const t=this._parse(e);return Ad(e._query,t),new vh(e.firestore,e.converter,Qr(e._query,t))}_parse(e){const t=Wh(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new T(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Dd(o,s);const t=[];for(const n of o)t.push(Cd(r,e,n));a={arrayValue:{values:t}}}else a=Cd(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Dd(o,s),a=rd(n,"where",o,"in"===s||"not-in"===s);return pr.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class bd extends yd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new bd(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:gr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Ad(n,e),n=Qr(n,e)}(e._query,t),new vh(e.firestore,e.converter,Qr(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Id extends vd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Id(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new T(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new T(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new hr(t,n)}(e._query,this._field,this._direction);return new vh(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Br(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class _d extends vd{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new _d(e,t,n)}_apply(e){return new vh(e.firestore,e.converter,Xr(e._query,this._limit,this._limitType))}}class Ed extends vd{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Ed(e,t,n)}_apply(e){const t=Sd(e,this.type,this._docOrFields,this._inclusive);return new vh(e.firestore,e.converter,function(e,t){return new Br(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Td extends vd{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Td(e,t,n)}_apply(e){const t=Sd(e,this.type,this._docOrFields,this._inclusive);return new vh(e.firestore,e.converter,function(e,t){return new Br(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Sd(e,t,n,r){if(n[0]=o.getModularInstance(n[0]),n[0]instanceof fd)return function(e,t,n,r,i){if(!r)throw new T(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Kr(e))if(n.field.isKeyField())s.push(Kn(t,r.key));else{const e=r.data.field(n.field);if(Tn(e))throw new T(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new T(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new cr(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Wh(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new T(E.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new T(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!$r(e)&&-1!==c.indexOf("/"))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(K.fromString(c));if(!H.isDocumentKey(n))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new H(n);a.push(Kn(t,i))}else{const e=rd(n,r,c);a.push(e)}}return new cr(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Cd(e,t,n){if("string"==typeof(n=o.getModularInstance(n))){if(""===n)throw new T(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$r(t)&&-1!==n.indexOf("/"))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(K.fromString(n));if(!H.isDocumentKey(r))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Kn(e,new H(r))}if(n instanceof wh)return Kn(e,n._key);throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ee(n)}.`)}function Dd(e,t){if(!Array.isArray(e)||0===e.length)throw new T(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ad(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new T(E.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new T(E.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function xd(e,t){if(!(t instanceof wd||t instanceof bd))throw new T(E.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class kd{convertValue(e,t="none"){switch(Rn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw w(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return rn(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Ln].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>vn(e.doubleValue));return new Bh(i)}convertGeoPoint(e){return new jh(vn(e.latitude),vn(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Sn(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Cn(e));default:return null}}convertTimestamp(e){const t=yn(e);return new ae(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=K.fromString(e);I(eo(n),9688,{name:e});const r=new xn(n.get(1),n.get(3)),i=new H(n.popFirst(5));return r.isEqual(t)||m(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Nd(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Od extends kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new wh(this.firestore,null,t)}}function Pd(){return new Lh("count")}const Ld="NOT SUPPORTED";class Md{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rd extends fd{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(gd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new T(E.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Rd._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Rd._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rd._jsonSchema={type:re("string",Rd._jsonSchemaVersion),bundleSource:re("string","DocumentSnapshot"),bundleName:re("string"),bundle:re("string")};class Fd extends Rd{data(e={}){return super.data(e)}}class Vd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Md(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Fd(this._firestore,this._userDataWriter,n.key,n,new Md(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Fd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Md(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Fd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Md(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:jd(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new T(E.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Vd._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=R.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function jd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return w(61501,{type:e})}}Vd._jsonSchemaVersion="firestore/querySnapshot/1.0",Vd._jsonSchema={type:re("string",Vd._jsonSchemaVersion),bundleSource:re("string","QuerySnapshot"),bundleName:re("string"),bundle:re("string")};class Bd extends kd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new wh(this.firestore,null,t)}}function Ud(e,...t){var n,r,i;e=o.getModularInstance(e);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||Ch(t[a])||(s=t[a++]);const c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ch(t[a])){const e=t[a];t[a]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[a+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[a+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,h;if(e instanceof wh)l=te(e.firestore,Ah),h=qr(e._key.path),u={next:n=>{t[a]&&t[a](zd(l,e,n))},error:t[a+1],complete:t[a+2]};else{const n=te(e,vh);l=te(n.firestore,Ah),h=n._query;const r=new Bd(l);u={next:e=>{t[a]&&t[a](new Vd(l,r,n,e))},error:t[a+1],complete:t[a+2]},md(e._query)}return function(e,t,n,r){const i=new Kl(r),s=new Xu(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>zu(await ah(e),s)),()=>{i.Ou(),e.asyncQueue.enqueueAndForget(async()=>$u(await ah(e),s))}}(xh(l),h,c,u)}function qd(e,t){return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=Vl(e);try{const e=await function(e,t){const n=_(e),r=ae.now(),i=t.reduce((e,t)=>e.add(t.key),gi());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=oi(),c=gi();return n.Os.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=Ui(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new $i(e.key,t,or(t.value.mapValue),Mi.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:ui(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ru[e.currentUser.toKey()];r||(r=new an(F)),r=r.insert(t,n),e.Ru[e.currentUser.toKey()]=r}(r,e.batchId,n),await Cl(r,e.changes),await _u(r.remoteStore)}catch(e){const t=Ru(e,"Failed to persist write");n.reject(t)}}(await sh(e),t,n)),n.promise}(xh(e),t)}function zd(e,t,n){const r=n.docs.get(t._key),i=new Bd(e);return new Rd(e,i,t._key,r,new Md(n.hasPendingWrites,n.fromCache),t.converter)}function $d(e,t){const n=te(e.firestore,Ah),r=xh(n),i=sn(t,(e,t)=>new Zi(t,e.aggregateType,e._internalFieldPath));return function(e,t,n){const r=new S;return e.asyncQueue.enqueueAndForget(async()=>{try{const i=await oh(e);r.resolve(async function(e,t,n){var r;const i=_(e),{request:s,ft:o,parent:a}=$s(i.serializer,Wr(t),n);i.connection.Qo||delete s.parent;const c=(await i.Jo("RunAggregationQuery",i.serializer.databaseId,a,s,1)).filter(e=>!!e.result);I(1===c.length,64727);const u=null===(r=c[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[o[t]]=u[t],e),{})}(i,t,n))}catch(e){r.reject(e)}}),r.promise}(r,e._query,i).then(t=>function(e,t,n){const r=new Bd(e);return new Mh(t,r,n)}(n,e,t))}class Kd{constructor(e){this.kind="memory",this._onlineComponentProvider=zl.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Bl(void 0)}}toJSON(){return{kind:this.kind}}}class Gd{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=Jd(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Wd{constructor(){this.kind="memoryEager",this._offlineComponentProvider=jl.provider}toJSON(){return{kind:this.kind}}}class Hd{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Bl(e)}}toJSON(){return{kind:this.kind}}}class Qd{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zl.provider,this._offlineComponentProvider={build:t=>new Ul(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class Xd{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zl.provider,this._offlineComponentProvider={build:t=>new ql(t,null==e?void 0:e.cacheSizeBytes)}}}function Jd(e){return new Qd(null==e?void 0:e.forceOwnership)}const Yd={maxAttempts:5};class Zd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Wh(e)}set(e,t,n){this._verifyNotCommitted();const r=ef(e,this._firestore),i=Nd(r.converter,t,n),s=Hh(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Mi.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=ef(e,this._firestore);let s;return s="string"==typeof(t=o.getModularInstance(t))||t instanceof Fh?nd(this._dataReader,"WriteBatch.update",i._key,t,n,r):td(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Mi.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ef(e,this._firestore);return this._mutations=this._mutations.concat(new Hi(t._key,Mi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ef(e,t){if((e=o.getModularInstance(e)).firestore!==t)throw new T(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class tf{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Wh(e)}get(e){const t=ef(e,this._firestore),n=new Od(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return w(24041);const r=e[0];if(r.isFoundDocument())return new fd(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new fd(this._firestore,n,t._key,null,t.converter);throw w(18433,{doc:r})})}set(e,t,n){const r=ef(e,this._firestore),i=Nd(r.converter,t,n),s=Hh(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=ef(e,this._firestore);let s;return s="string"==typeof(t=o.getModularInstance(t))||t instanceof Fh?nd(this._dataReader,"Transaction.update",i._key,t,n,r):td(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=ef(e,this._firestore);return this._transaction.delete(t._key),this}}class nf extends tf{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ef(e,this._firestore),n=new Bd(this._firestore);return super.get(e).then(e=>new Rd(this._firestore,n,t._key,e._document,new Md(!1,!1),t.converter))}}function rf(e,t){if("string"!=typeof e[t])throw new T(E.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class sf{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function of(e,t){(function(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){_(e).Cs.Rs=t}(await rh(e),t))})(xh(e._firestore),t).then(e=>g(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>y(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}const af=new WeakMap;class cf{constructor(){this.Fc=new Map}static get instance(){return uf||(uf=new cf,function(e){if(ss)throw new Error("a TestingHooksSpi instance is already set");ss=e}(uf)),uf}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Fc;return n.set(t,e),()=>n.delete(t)}}let uf=null;!function(e,t=!0){!function(e){d=e}(r.SDK_VERSION),r._registerComponent(new i.Component("firestore",(e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Ah(new x(e.getProvider("auth-internal")),new P(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new T(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),r.registerVersion(u,l,e),r.registerVersion(u,l,"cjs2017")}(),t.AbstractUserDataWriter=kd,t.AggregateField=Lh,t.AggregateQuerySnapshot=Mh,t.Bytes=Rh,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=bh,t.DocumentReference=wh,t.DocumentSnapshot=Rd,t.FieldPath=Fh,t.FieldValue=Vh,t.Firestore=Ah,t.FirestoreError=T,t.GeoPoint=jh,t.LoadBundleTask=Dh,t.PersistentCacheIndexManager=sf,t.Query=vh,t.QueryCompositeFilterConstraint=bd,t.QueryConstraint=vd,t.QueryDocumentSnapshot=Fd,t.QueryEndAtConstraint=Td,t.QueryFieldFilterConstraint=wd,t.QueryLimitConstraint=_d,t.QueryOrderByConstraint=Id,t.QuerySnapshot=Vd,t.QueryStartAtConstraint=Ed,t.SnapshotMetadata=Md,t.Timestamp=ae,t.Transaction=nf,t.VectorValue=Bh,t.WriteBatch=Zd,t._AutoId=R,t._ByteString=gn,t._DatabaseId=xn,t._DocumentKey=H,t._EmptyAppCheckTokenProvider=class{getToken(){return Promise.resolve(new O(""))}invalidateToken(){}start(e,t){}shutdown(){}},t._EmptyAuthCredentialsProvider=D,t._FieldPath=W,t._TestingHooks=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return cf.instance.onExistenceFilterMismatch(e)}},t._cast=te,t._debugAssert=function(e,t){e||w(57014,t)},t._internalAggregationQueryToProtoRunAggregationQueryRequest=function(e,t){var n;const r=sn(t,(e,t)=>new Zi(t,e.aggregateType,e._internalFieldPath)),i=null===(n=xh(te(e.firestore,Ah))._onlineComponents)||void 0===n?void 0:n.datastore.serializer;return void 0===i?null:$s(i,Wr(e._query),r,!0).request},t._internalQueryToProtoQueryTarget=function(e){var t;const n=null===(t=xh(te(e.firestore,Ah))._onlineComponents)||void 0===t?void 0:t.datastore.serializer;return void 0===n?null:zs(n,Gr(e._query)).Vt},t._isBase64Available=function(){return"undefined"!=typeof atob},t._logWarn=y,t._validateIsNotUsedTogether=X,t.addDoc=function(e,t){const n=te(e.firestore,Ah),r=Ih(e),i=Nd(e.converter,t);return qd(n,[Hh(Wh(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Mi.exists(!1))]).then(()=>r)},t.aggregateFieldEqual=function(e,t){var n,r;return e instanceof Lh&&t instanceof Lh&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())},t.aggregateQuerySnapshotEqual=function(e,t){return _h(e.query,t.query)&&o.deepEqual(e.data(),t.data())},t.and=function(...e){return e.forEach(e=>xd("and",e)),bd._create("and",e)},t.arrayRemove=function(...e){return new Zh("arrayRemove",e)},t.arrayUnion=function(...e){return new Yh("arrayUnion",e)},t.average=function(e){return new Lh("avg",cd("average",e))},t.clearIndexedDbPersistence=function(e){if(e._initialized&&!e._terminated)throw new T(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new S;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!De.C())return Promise.resolve();const t=e+ec;await De.delete(t)}(ic(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise},t.collection=function(e,t,...n){if(e=o.getModularInstance(e),Q("collection","path",t),e instanceof mh){const r=K.fromString(t,...n);return Y(r),new bh(e,null,r)}{if(!(e instanceof wh||e instanceof bh))throw new T(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(K.fromString(t,...n));return Y(r),new bh(e.firestore,null,r)}},t.collectionGroup=function(e,t){if(e=te(e,mh),Q("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new T(E.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vh(e,null,function(e){return new Br(K.emptyPath(),e)}(t))},t.connectFirestoreEmulator=yh,t.count=Pd,t.deleteAllPersistentCacheIndexes=function(e){(function(e){return e.asyncQueue.enqueue(async()=>function(e){const t=_(e),n=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}(await rh(e)))})(xh(e._firestore)).then(e=>g("deleting all persistent cache indexes succeeded")).catch(e=>y("deleting all persistent cache indexes failed",e))},t.deleteDoc=function(e){return qd(te(e.firestore,Ah),[new Hi(e._key,Mi.none())])},t.deleteField=function(){return new Qh("deleteField")},t.disableNetwork=function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await nh(e),n=await ih(e);return t.setNetworkEnabled(!1),async function(e){const t=_(e);t.Ia.add(0),await au(t),t.Aa.set("Offline")}(n)})}(xh(e=te(e,Ah)))},t.disablePersistentCacheIndexAutoCreation=function(e){of(e,!1)},t.doc=Ih,t.documentId=function(){return new Fh(z)},t.documentSnapshotFromJSON=function(e,t,n){if(ie(t,Rd._jsonSchema)){if(t.bundle===Ld)throw new T(E.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Qc(e._databaseId),i=lh(t.bundle,r),s=i.Ku(),o=new Zu(i.getMetadata(),r);for(const e of s)o.Wa(e);const a=o.documents;if(1!==a.length)throw new T(E.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const c=js(r,a[0].document),u=new H(K.fromString(t.bundleName));return new Rd(e,new Od(e),u,c,new Md(!1,!1),n||null)}},t.enableIndexedDbPersistence=function(e,t){y("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return Nh(e,zl.provider,{build:e=>new Ul(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()},t.enableMultiTabIndexedDbPersistence=async function(e){y("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();Nh(e,zl.provider,{build:e=>new ql(e,t.cacheSizeBytes)})},t.enableNetwork=function(e){return function(e){return e.asyncQueue.enqueue(async()=>{const t=await nh(e),n=await ih(e);return t.setNetworkEnabled(!0),function(e){const t=_(e);return t.Ia.delete(0),ou(t)}(n)})}(xh(e=te(e,Ah)))},t.enablePersistentCacheIndexAutoCreation=function(e){of(e,!0)},t.endAt=function(...e){return Td._create("endAt",e,!0)},t.endBefore=function(...e){return Td._create("endBefore",e,!1)},t.ensureFirestoreConfigured=xh,t.executeWrite=qd,t.getAggregateFromServer=$d,t.getCountFromServer=function(e){return $d(e,{count:Pd()})},t.getDoc=function(e){e=te(e,wh);const t=te(e.firestore,Ah);return ch(xh(t),e._key).then(n=>zd(t,e,n))},t.getDocFromCache=function(e){e=te(e,wh);const t=te(e.firestore,Ah),n=xh(t),r=new Bd(t);return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(e,t){const n=_(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new T(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Ru(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await rh(e),t,n)),n.promise}(n,e._key).then(n=>new Rd(t,r,e._key,n,new Md(null!==n&&n.hasLocalMutations,!0),e.converter))},t.getDocFromServer=function(e){e=te(e,wh);const t=te(e.firestore,Ah);return ch(xh(t),e._key,{source:"server"}).then(n=>zd(t,e,n))},t.getDocs=function(e){e=te(e,vh);const t=te(e.firestore,Ah),n=xh(t),r=new Bd(t);return md(e._query),uh(n,e._query).then(n=>new Vd(t,r,e,n))},t.getDocsFromCache=function(e){e=te(e,vh);const t=te(e.firestore,Ah),n=xh(t),r=new Bd(t);return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await yc(e,t,!0),i=new rl(t,r.qs),s=i.nu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Ru(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await rh(e),t,n)),n.promise}(n,e._query).then(n=>new Vd(t,r,e,n))},t.getDocsFromServer=function(e){e=te(e,vh);const t=te(e.firestore,Ah),n=xh(t),r=new Bd(t);return uh(n,e._query,{source:"server"}).then(n=>new Vd(t,r,e,n))},t.getFirestore=function(e,t){const n="object"==typeof e?e:r.getApp(),i="string"==typeof e?e:t||An,s=r._getProvider(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=o.getDefaultEmulatorHostnameAndPort("firestore");e&&yh(s,...e)}return s},t.getPersistentCacheIndexManager=function(e){var t;e=te(e,Ah);const n=af.get(e);if(n)return n;if("persistent"!==(null===(t=xh(e)._uninitializedComponentsProvider)||void 0===t?void 0:t._offline.kind))return null;const r=new sf(e);return af.set(e,r),r},t.increment=function(e){return new ed("increment",e)},t.initializeFirestore=function(e,t,n){n||(n=An);const i=r._getProvider(e,"firestore");if(i.isInitialized(n)){const e=i.getImmediate({identifier:n}),r=i.getOptions(n);if(o.deepEqual(r,t))return e;throw new T(E.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new T(E.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<ma)throw new T(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&o.isCloudWorkstation(t.host)&&o.pingServer(t.host),i.initialize({options:t,instanceIdentifier:n})},t.limit=function(e){return ne("limit",e),_d._create("limit",e,"F")},t.limitToLast=function(e){return ne("limitToLast",e),_d._create("limitToLast",e,"L")},t.loadBundle=Oh,t.memoryEagerGarbageCollector=function(){return new Wd},t.memoryLocalCache=function(e){return new Kd(e)},t.memoryLruGarbageCollector=function(e){return new Hd(null==e?void 0:e.cacheSizeBytes)},t.namedQuery=Ph,t.onSnapshot=Ud,t.onSnapshotResume=function(e,t,...n){const r=o.getModularInstance(e),i=function(e){const t={bundle:"",bundleName:"",bundleSource:""},n=["bundle","bundleName","bundleSource"];for(const r of n){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}const n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(i.error)throw new T(E.INVALID_ARGUMENT,i.error);let s,a=0;if("object"!=typeof n[a]||Ch(n[a])||(s=n[a++]),"QuerySnapshot"===i.bundleSource){let e=null;if("object"==typeof n[a]&&Ch(n[a])){const t=n[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:n[a++],error:n[a++],complete:n[a++]};return function(e,t,n,r,i){let s,o=!1;return Oh(e,t.bundle).then(()=>Ph(e,t.bundleName)).then(e=>{e&&!o&&(i&&e.withConverter(i),s=Ud(e,n||{},r))}).catch(e=>(r.error&&r.error(e),()=>{})),()=>{o||(o=!0,s&&s())}}(r,i,s,e,n[a])}if("DocumentSnapshot"===i.bundleSource){let e=null;if("object"==typeof n[a]&&Ch(n[a])){const t=n[a++];e={next:t.next,error:t.error,complete:t.complete}}else e={next:n[a++],error:n[a++],complete:n[a++]};return function(e,t,n,r,i){let s,o=!1;return Oh(e,t.bundle).then(()=>{if(!o){const o=new wh(e,i||null,H.fromPath(t.bundleName));s=Ud(o,n||{},r)}}).catch(e=>(r.error&&r.error(e),()=>{})),()=>{o||(o=!0,s&&s())}}(r,i,s,e,n[a])}throw new T(E.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)},t.onSnapshotsInSync=function(e,t){return function(e,t){const n=new Kl(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){_(e).Da.add(t),t.next()}(await ah(e),n)),()=>{n.Ou(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){_(e).Da.delete(t)}(await ah(e),n))}}(xh(e=te(e,Ah)),Ch(t)?t:{next:t})},t.or=function(...e){return e.forEach(e=>xd("or",e)),bd._create("or",e)},t.orderBy=function(e,t="asc"){const n=t,r=gd("orderBy",e);return Id._create(r,n)},t.persistentLocalCache=function(e){return new Gd(e)},t.persistentMultipleTabManager=function(){return new Xd},t.persistentSingleTabManager=Jd,t.query=function(e,t,...n){let r=[];t instanceof yd&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof bd).length,n=e.filter(e=>e instanceof wd).length;if(t>1||t>0&&n>0)throw new T(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e},t.queryEqual=_h,t.querySnapshotFromJSON=function(e,t,n){if(ie(t,Vd._jsonSchema)){if(t.bundle===Ld)throw new T(E.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Qc(e._databaseId),i=lh(t.bundle,r),s=i.Ku(),o=new Zu(i.getMetadata(),r);for(const e of s)o.Wa(e);if(1!==o.queries.length)throw new T(E.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=lo(o.queries[0].bundledQuery),c=o.documents;let u=new Fu;c.map(e=>{const t=js(r,e.document);u=u.add(t)});const l=ju.fromInitialDocuments(a,u,gi(),!1,!1),h=new vh(e,n||null,a);return new Vd(e,new Od(e),h,l)}},t.refEqual=function(e,t){return e=o.getModularInstance(e),t=o.getModularInstance(t),(e instanceof wh||e instanceof bh)&&(t instanceof wh||t instanceof bh)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter},t.runTransaction=function(e,t,n){e=te(e,Ah);const r=Object.assign(Object.assign({},Yd),n);return function(e){if(e.maxAttempts<1)throw new T(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new S;return e.asyncQueue.enqueueAndForget(async()=>{const i=await oh(e);new Ql(e.asyncQueue,i,n,t,r).zu()}),r.promise}(xh(e),n=>t(new nf(e,n)),r)},t.serverTimestamp=function(){return new Jh("serverTimestamp")},t.setDoc=function(e,t,n){e=te(e,wh);const r=te(e.firestore,Ah),i=Nd(e.converter,t,n);return qd(r,[Hh(Wh(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Mi.none())])},t.setIndexConfiguration=function(e,t){const n=xh(e=te(e,Ah));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return y("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(e){const t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new T(E.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(const e of t.indexes){const t=rf(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(const t of e.fields){const e=ld("setIndexConfiguration",rf(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new pe(e,2)):"ASCENDING"===t.order?r.push(new pe(e,0)):"DESCENDING"===t.order&&r.push(new pe(e,1))}n.push(new le(le.UNKNOWN_ID,t,r,me.empty()))}return n}(t);return function(e,t){return e.asyncQueue.enqueue(async()=>async function(e,t){const n=_(e),r=n.indexManager,i=[];return n.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(n=>function(e,t,n,r,i){e=[...e],t=[...t],e.sort(n),t.sort(n);const s=e.length,o=t.length;let a=0,c=0;for(;a<o&&c<s;){const s=n(e[c],t[a]);s<0?i(e[c++]):s>0?r(t[a++]):(a++,c++)}for(;a<o;)r(t[a++]);for(;c<s;)i(e[c++])}(n,t,fe,t=>{i.push(r.addFieldIndex(e,t))},t=>{i.push(r.deleteFieldIndex(e,t))})).next(()=>Te.waitFor(i)))}(await rh(e),t))}(n,r)},t.setLogLevel=function(e){f.setLogLevel(e)},t.snapshotEqual=function(e,t){return e instanceof Rd&&t instanceof Rd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Vd&&t instanceof Vd&&e._firestore===t._firestore&&_h(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)},t.startAfter=function(...e){return Ed._create("startAfter",e,!1)},t.startAt=function(...e){return Ed._create("startAt",e,!0)},t.sum=function(e){return new Lh("sum",cd("sum",e))},t.terminate=function(e){return r._removeServiceInstance(e.app,"firestore",e._databaseId.database),e._delete()},t.updateDoc=function(e,t,n,...r){e=te(e,wh);const i=te(e.firestore,Ah),s=Wh(i);let a;return a="string"==typeof(t=o.getModularInstance(t))||t instanceof Fh?nd(s,"updateDoc",e._key,t,n,r):td(s,"updateDoc",e._key,t),qd(i,[a.toMutation(e._key,Mi.exists(!0))])},t.vector=function(e){return new Bh(e)},t.waitForPendingWrites=function(e){return function(e){const t=new S;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=_(e);pu(n.remoteStore)||g(il,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=_(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(e===Be)return void t.resolve();const r=n.Vu.get(e)||[];r.push(t),n.Vu.set(e,r)}catch(e){const n=Ru(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await sh(e),t)),t.promise}(xh(e=te(e,Ah)))},t.where=function(e,t,n){const r=t,i=gd("where",e);return wd._create(i,r,n)},t.writeBatch=function(e){return xh(e=te(e,Ah)),new Zd(e,t=>qd(e,t))}},319:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(336);const i="[DEFAULT]";class s{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.Deferred;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=i){return this.instances.has(e)}getOptions(e=i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===i?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=i){return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}t.Component=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}},t.ComponentContainer=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new s(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}},t.Provider=s},336:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(873);const i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new u;const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class u extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l=function(e){const t=a(e);return c.encodeByteArray(t,!0)},h=function(e){return l(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&p(n)&&(e[n]=f(e[n],t[n]));return e}function p(e){return"__proto__"!==e}function g(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}const m=()=>{try{return r.getDefaultsFromPostinstall()||g().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},y=e=>{var t,n;return null===(n=null===(t=m())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]};class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function w(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}const b={};let I=!1;function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function E(){var e;const t=null===(e=m())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function T(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C.prototype.create)}}class C{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(D,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new S(r,o,n)}}const D=/\{\$([^}]+)}/g;function A(e){return JSON.parse(e)}const x=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=A(d(s[0])||""),n=A(d(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function k(e){return null!==e&&"object"==typeof e}class N{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=O),void 0===r.error&&(r.error=O),void 0===r.complete&&(r.complete=O);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O(){}function P(e,t){return`${e} failed: ${t} argument `}const L=144e5;t.CONSTANTS=i,t.DecodeBase64StringError=u,t.Deferred=v,t.ErrorFactory=C,t.FirebaseError=S,t.MAX_VALUE_MILLIS=L,t.RANDOM_FACTOR=.5,t.Sha1=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):e<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const t=(s<<5|s>>>27)+r+u+i+n[e]&4294967295;u=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}},t.areCookiesEnabled=function(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)},t.assert=s,t.assertionError=o,t.async=function(e,t){return(...n)=>{Promise.resolve(!0).then(()=>{e(...n)}).catch(e=>{t&&t(e)})}},t.base64=c,t.base64Decode=d,t.base64Encode=l,t.base64urlEncodeWithoutPadding=h,t.calculateBackoffMillis=function(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(L,r+i)},t.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.createMockUserToken=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(s)),""].join(".")},t.createSubscribe=function(e,t){const n=new N(e,t);return n.subscribe.bind(n)},t.decode=x,t.deepCopy=function(e){return f(void 0,e)},t.deepEqual=function e(t,n){if(t===n)return!0;const r=Object.keys(t),i=Object.keys(n);for(const s of r){if(!i.includes(s))return!1;const r=t[s],o=n[s];if(k(r)&&k(o)){if(!e(r,o))return!1}else if(r!==o)return!1}for(const e of i)if(!r.includes(e))return!1;return!0},t.deepExtend=f,t.errorPrefix=P,t.extractQuerystring=function(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)},t.getDefaultAppConfig=()=>{var e;return null===(e=m())||void 0===e?void 0:e.config},t.getDefaultEmulatorHost=y,t.getDefaultEmulatorHostnameAndPort=e=>{const t=y(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},t.getDefaults=m,t.getExperimentalSetting=e=>{var t;return null===(t=m())||void 0===t?void 0:t[`_${e}`]},t.getGlobal=g,t.getModularInstance=function(e){return e&&e._delegate?e._delegate:e},t.getUA=_,t.isAdmin=function(e){const t=x(e).claims;return"object"==typeof t&&!0===t.admin},t.isBrowser=function(){return"undefined"!=typeof window||T()},t.isBrowserExtension=function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id},t.isCloudWorkstation=w,t.isCloudflareWorker=function(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent},t.isElectron=function(){return _().indexOf("Electron/")>=0},t.isEmpty=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},t.isIE=function(){const e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0},t.isIndexedDBAvailable=function(){try{return"object"==typeof indexedDB}catch(e){return!1}},t.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())},t.isNode=E,t.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},t.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},t.isSafari=function(){return!E()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")},t.isSafariOrWebkit=function(){return!E()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")},t.isUWP=function(){return _().indexOf("MSAppHost/")>=0},t.isValidFormat=function(e){const t=x(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},t.isValidTimestamp=function(e){const t=x(e).claims,n=Math.floor((new Date).getTime()/1e3);let r=0,i=0;return"object"==typeof t&&(t.hasOwnProperty("nbf")?r=t.nbf:t.hasOwnProperty("iat")&&(r=t.iat),i=t.hasOwnProperty("exp")?t.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i},t.isWebWorker=T,t.issuedAtTime=function(e){const t=x(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null},t.jsonEval=A,t.map=function(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r},t.ordinal=function(e){return Number.isFinite(e)?e+function(e){const t=(e=Math.abs(e))%100;if(t>=10&&t<=20)return"th";const n=e%10;return 1===n?"st":2===n?"nd":3===n?"rd":"th"}(e):`${e}`},t.pingServer=async function(e){return(await fetch(e,{credentials:"include"})).ok},t.promiseWithTimeout=function(e,t=2e3){const n=new v;return setTimeout(()=>n.reject("timeout!"),t),e.then(n.resolve,n.reject),n.promise},t.querystring=function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""},t.querystringDecode=function(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t},t.safeGet=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0},t.stringLength=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t},t.stringToByteArray=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t.stringify=function(e){return JSON.stringify(e)},t.updateEmulatorBanner=function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!w(window.location.host)||b[e]===t||b[e]||I)return;function n(e){return`__firebase__banner__${e}`}b[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(b))b[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),s=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{I=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,s,a,n),document.body.appendChild(t)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()},t.validateArgCount=function(e,t,n,r){let i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},t.validateCallback=function(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(P(e,t)+"must be a valid function.")},t.validateContextObject=function(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(P(e,t)+"must be a valid context object.")},t.validateIndexedDBOpenable=function(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})},t.validateNamespace=function(e,t,n){if((!n||t)&&"string"!=typeof t)throw new Error(P(e,"namespace")+"must be a valid firebase namespace.")}},489:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(319),s=n(336),o=n(148);const a="@firebase/installations",c="0.6.18",u=`w:${c}`,l="FIS_v2",h=new s.ErrorFactory("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function d(e){return e instanceof s.FirebaseError&&e.code.includes("request-failed")}function f({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function p(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function g(e,t){const n=(await t.json()).error;return h.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function m({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function y(e,{refreshToken:t}){const n=m(e);return n.append("Authorization",function(e){return`${l} ${e}`}(t)),n}async function v(e){const t=await e();return t.status>=500&&t.status<600?e():t}function w(e){return new Promise(t=>{setTimeout(t,e)})}const b=/^[cdef][\w-]{21}$/;function I(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return b.test(t)?t:""}catch(e){return""}}function _(e){return`${e.appName}!${e.appId}`}const E=new Map;function T(e,t){const n=_(e);S(n,t),function(e,t){const n=D();n&&n.postMessage({key:e,fid:t}),A()}(n,t)}function S(e,t){const n=E.get(e);if(n)for(const e of n)e(t)}let C=null;function D(){return!C&&"BroadcastChannel"in self&&(C=new BroadcastChannel("[Firebase] FID Change"),C.onmessage=e=>{S(e.data.key,e.data.fid)}),C}function A(){0===E.size&&C&&(C.close(),C=null)}const x="firebase-installations-store";let k=null;function N(){return k||(k=o.openDB("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(x)}})),k}async function O(e,t){const n=_(e),r=(await N()).transaction(x,"readwrite"),i=r.objectStore(x),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||T(e,t.fid),t}async function P(e){const t=_(e),n=(await N()).transaction(x,"readwrite");await n.objectStore(x).delete(t),await n.done}async function L(e,t){const n=_(e),r=(await N()).transaction(x,"readwrite"),i=r.objectStore(x),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||T(e,o.fid),o}async function M(e){let t;const n=await L(e.appConfig,n=>{const r=function(e){return V(e||{fid:I(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(h.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=f(e),i=m(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:l,appId:e.appId,sdkVersion:u},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await v(()=>fetch(r,a));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:p(e.authToken)}}throw await g("Create Installation",c)}(e,t);return O(e.appConfig,n)}catch(n){throw d(n)&&409===n.customData.serverCode?await P(e.appConfig):await O(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:R(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function R(e){let t=await F(e.appConfig);for(;1===t.registrationStatus;)await w(100),t=await F(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await M(e);return n||t}return t}function F(e){return L(e,e=>{if(!e)throw h.create("installation-not-found");return V(e)})}function V(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function j(e,t=!1){let n;const r=await L(e.appConfig,r=>{if(!U(r))throw h.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await B(e.appConfig);for(;1===n.authToken.requestStatus;)await w(100),n=await B(e.appConfig);const r=n.authToken;return 0===r.requestStatus?j(e,t):r}(e,t),r;{if(!navigator.onLine)throw h.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${f(e)}/${t}/authTokens:generate`}(e,n),i=y(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:u,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await v(()=>fetch(r,a));if(c.ok)return p(await c.json());throw await g("Generate Auth Token",c)}(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await O(e.appConfig,r),n}catch(n){if(!d(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await O(e.appConfig,n)}else await P(e.appConfig);throw n}}(e,t),t}});return n?await n:r.authToken}function B(e){return L(e,e=>{if(!U(e))throw h.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t})}function U(e){return void 0!==e&&2===e.registrationStatus}async function q(e){const t=e,{installationEntry:n,registrationPromise:r}=await M(t);return r?r.catch(console.error):j(t).catch(console.error),n.fid}async function z(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await M(e);t&&await t}(n),(await j(n,t)).token}function $(e){return h.create("missing-app-config-values",{valueName:e})}const K="installations";r._registerComponent(new i.Component(K,e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw $("App Configuration");if(!e.name)throw $("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw $(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:r._getProvider(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),r._registerComponent(new i.Component("installations-internal",e=>{const t=e.getProvider("app").getImmediate(),n=r._getProvider(t,K).getImmediate();return{getId:()=>q(n),getToken:e=>z(n,e)}},"PRIVATE")),r.registerVersion(a,c),r.registerVersion(a,c,"cjs2017"),t.deleteInstallations=async function(e){const{appConfig:t}=e,n=await L(t,e=>{if(!e||0!==e.registrationStatus)return e});if(n){if(1===n.registrationStatus)throw h.create("delete-pending-registration");if(2===n.registrationStatus){if(!navigator.onLine)throw h.create("app-offline");await async function(e,t){const n=function(e,{fid:t}){return`${f(e)}/${t}`}(e,t),r={method:"DELETE",headers:y(e,t)},i=await v(()=>fetch(n,r));if(!i.ok)throw await g("Delete Installation",i)}(t,n),await P(t)}}},t.getId=q,t.getInstallations=function(e=r.getApp()){return r._getProvider(e,"installations").getImmediate()},t.getToken=z,t.onIdChange=function(e,t){const{appConfig:n}=e;return function(e,t){D();const n=_(e);let r=E.get(n);r||(r=new Set,E.set(n,r)),r.add(t)}(n,t),()=>{!function(e,t){const n=_(e),r=E.get(n);r&&(r.delete(t),0===r.size&&E.delete(n),A())}(n,t)}}},577:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199);r.registerVersion("firebase","11.10.0","app"),Object.keys(r).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},790:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(489);var r=n(319),i=n(148),s=n(336),o=n(199);const a="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",c="google.c.a.c_id";var u,l;function h(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function d(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(u||(u={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(l||(l={}));const f="fcm_token_details_db",p="fcm_token_object_Store",g="firebase-messaging-store";let m=null;function y(){return m||(m=i.openDB("firebase-messaging-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(g)}})),m}async function v(e){const t=b(e),n=await y(),r=await n.transaction(g).objectStore(g).get(t);if(r)return r;{const t=await async function(e){if("databases"in indexedDB){const e=(await indexedDB.databases()).map(e=>e.name);if(!e.includes(f))return null}let t=null;return(await i.openDB(f,5,{upgrade:async(n,r,i,s)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(p))return;const a=s.objectStore(p),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===r){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:h(e.vapidKey)}}}else if(3===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:h(e.auth),p256dh:h(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:h(e.vapidKey)}}}else if(4===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:h(e.auth),p256dh:h(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:h(e.vapidKey)}}}}})).close(),await i.deleteDB(f),await i.deleteDB("fcm_vapid_details_db"),await i.deleteDB("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await w(e,t),t}}async function w(e,t){const n=b(e),r=(await y()).transaction(g,"readwrite");return await r.objectStore(g).put(t,n),await r.done,t}function b({appConfig:e}){return e.appId}const I=new s.ErrorFactory("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function _(e,t){const n={method:"DELETE",headers:await T(e)};try{const r=await fetch(`${E(e.appConfig)}/${t}`,n),i=await r.json();if(i.error){const e=i.error.message;throw I.create("token-unsubscribe-failed",{errorInfo:e})}}catch(e){throw I.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function E({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function T({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function S({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==a&&(i.web.applicationPubKey=r),i}async function C(e,t){const n=await async function(e,t){const n=await T(e),r=S(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{const t=await fetch(E(e.appConfig),i);s=await t.json()}catch(e){throw I.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw I.create("token-subscribe-failed",{errorInfo:e})}if(!s.token)throw I.create("token-subscribe-no-token");return s.token}(e,t),r={token:n,createTime:Date.now(),subscriptionOptions:t};return await w(e,r),r.token}function D(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}(t,e),t}function A(e){return I.create("missing-app-config-values",{valueName:e})}!function(e,t){const n=[];for(let r=0;r<20;r++)n.push(e.charAt(r)),r<19&&n.push(t.charAt(r));n.join("")}("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class x{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw A("App Configuration Object");if(!e.name)throw A("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const e of t)if(!n[e])throw A(e);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function k(e){try{e.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch(()=>{}),await async function(e){return new Promise((t,n)=>{const r=setTimeout(()=>n(new Error("Service worker not registered after 10000 ms")),1e4),i=e.installing||e.waiting;e.active?(clearTimeout(r),t()):i?i.onstatechange=e=>{var n;"activated"===(null===(n=e.target)||void 0===n?void 0:n.state)&&(i.onstatechange=null,clearTimeout(r),t())}:(clearTimeout(r),n(new Error("No incoming service worker found.")))})}(e.swRegistration)}catch(e){throw I.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function N(e,t){if(!navigator)throw I.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw I.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=a)}(e,null==t?void 0:t.vapidKey),await async function(e,t){if(t||e.swRegistration||await k(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw I.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),async function(e){const t=await async function(e,t){return await e.pushManager.getSubscription()||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:d(t)})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:h(t.getKey("auth")),p256dh:h(t.getKey("p256dh"))},r=await v(e.firebaseDependencies);if(r){if(function(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?async function(e,t){try{const n=await async function(e,t){const n=await T(e),r=S(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{const n=await fetch(`${E(e.appConfig)}/${t.token}`,i);s=await n.json()}catch(e){throw I.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw I.create("token-update-failed",{errorInfo:e})}if(!s.token)throw I.create("token-update-no-token");return s.token}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await w(e.firebaseDependencies,r),n}catch(e){throw e}}(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await _(e.firebaseDependencies,r.token)}catch(e){console.warn(e)}return C(e.firebaseDependencies,n)}return C(e.firebaseDependencies,n)}(e)}async function O(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===l.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(D(n)):e.onMessageHandler.next(D(n)));const r=n.data;var i;"object"==typeof(i=r)&&i&&c in i&&"1"===r["google.c.a.e"]&&await async function(e,t,n){const r=function(e){switch(e){case l.NOTIFICATION_CLICKED:return"notification_open";case l.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[c],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}(e,n.messageType,r)}const P="@firebase/messaging",L="0.12.22";async function M(){try{await s.validateIndexedDBOpenable()}catch(e){return!1}return"undefined"!=typeof window&&s.isIndexedDBAvailable()&&s.areCookiesEnabled()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}o._registerComponent(new r.Component("messaging",e=>{const t=new x(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>O(t,e)),t},"PUBLIC")),o._registerComponent(new r.Component("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>N(t,e)}},"PRIVATE")),o.registerVersion(P,L),o.registerVersion(P,L,"cjs2017"),t.deleteToken=function(e){return async function(e){if(!navigator)throw I.create("only-available-in-window");return e.swRegistration||await k(e),async function(e){const t=await v(e.firebaseDependencies);t&&(await _(e.firebaseDependencies,t.token),await async function(e){const t=b(e),n=(await y()).transaction(g,"readwrite");await n.objectStore(g).delete(t),await n.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}(e)}(e=s.getModularInstance(e))},t.getMessaging=function(e=o.getApp()){return M().then(e=>{if(!e)throw I.create("unsupported-browser")},e=>{throw I.create("indexed-db-unsupported")}),o._getProvider(s.getModularInstance(e),"messaging").getImmediate()},t.getToken=async function(e,t){return N(e=s.getModularInstance(e),t)},t.isSupported=M,t.onMessage=function(e,t){return function(e,t){if(!navigator)throw I.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=s.getModularInstance(e),t)}},815:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(241);Object.keys(r).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},832:(e,t,n)=>{(function(){"use strict";var t,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))break e;n=n[o]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function c(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function u(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function h(e,t,n){return(h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?u:l).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function p(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(a(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function m(e){return/^[\s\xa0]*$/.test(e)}function y(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function v(e){return v[" "](e),e}v[" "]=function(){};var w=!(-1==y().indexOf("Gecko")||-1!=y().toLowerCase().indexOf("webkit")&&-1==y().indexOf("Edge")||-1!=y().indexOf("Trident")||-1!=y().indexOf("MSIE")||-1!=y().indexOf("Edge"));function b(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function I(e){const t={};for(const n in e)t[n]=e[n];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<_.length;t++)n=_[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function T(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){o.setTimeout(()=>{throw e},0)}function C(){var e=N;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var D=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new A,e=>e.reset());class A{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let x,k=!1,N=new class{constructor(){this.h=this.g=null}add(e,t){const n=D.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=o.Promise.resolve(void 0);x=()=>{e.then(P)}};var P=()=>{for(var e;e=C();){try{e.h.call(e.g)}catch(e){S(e)}var t=D;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}k=!1};function L(){this.s=this.s,this.C=this.C}function M(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}L.prototype.s=!1,L.prototype.ma=function(){this.s||(this.s=!0,this.N())},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function F(e,t){if(M.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(w){e:{try{v(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:V[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&F.aa.h.call(this)}}f(F,M);var V={2:"touch",3:"pen",4:"mouse"};F.prototype.h=function(){F.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var j="closure_listenable_"+(1e6*Math.random()|0),B=0;function U(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++B,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function K(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}z.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=K(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new U(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),W={};function H(e,t,n,r,i){if(r&&r.once)return X(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)H(e,t[s],n,r,i);return null}return n=re(n),e&&e[j]?e.K(t,n,c(r)?!!r.capture:!!r,i):Q(e,t,n,!1,r,i)}function Q(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=c(i)?!!i.capture:!!i,a=te(e);if(a||(e[G]=a=new z(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=ee;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)R||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Z(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function X(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)X(e,t[s],n,r,i);return null}return n=re(n),e&&e[j]?e.L(t,n,c(r)?!!r.capture:!!r,i):Q(e,t,n,!0,r,i)}function J(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)J(e,t[s],n,r,i);else r=c(r)?!!r.capture:!!r,n=re(n),e&&e[j]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=K(s=e.g[t],n,r,i))&&(q(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=te(e))&&(t=e.g[t.toString()],e=-1,t&&(e=K(t,n,r,i)),(n=-1<e?t[e]:null)&&Y(n))}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[j])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Z(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=te(t))?($(n,e),0==n.h&&(n.src=null,t[G]=null)):q(e)}}}function Z(e){return e in W?W[e]:W[e]="on"+e}function ee(e,t){if(e.da)e=!0;else{t=new F(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&Y(e),e=n.call(r,t)}return e}function te(e){return(e=e[G])instanceof z?e:null}var ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function re(e){return"function"==typeof e?e:(e[ne]||(e[ne]=function(t){return e.handleEvent(t)}),e[ne])}function ie(){L.call(this),this.i=new z(this),this.M=this,this.F=null}function se(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new M(t,e);else if(t instanceof M)t.target=t.target||e;else{var i=t;E(t=new M(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=oe(o,r,!0,t)&&i}if(i=oe(o=t.g=e,r,!0,t)&&i,i=oe(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=oe(o=t.g=n[s],r,!1,t)&&i}function oe(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function ae(e,t,n){if("function"==typeof e)n&&(e=h(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=h(e.handleEvent,e)}return 2147483647<Number(t)?-1:o.setTimeout(e,t||0)}function ce(e){e.g=ae(()=>{e.g=null,e.i&&(e.i=!1,ce(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}f(ie,L),ie.prototype[j]=!0,ie.prototype.removeEventListener=function(e,t,n,r){J(this,e,t,n,r)},ie.prototype.N=function(){if(ie.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)q(n[r]);delete t.g[e],t.h--}}this.F=null},ie.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ie.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ue extends L{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ce(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){L.call(this),this.h=e,this.g={}}f(le,L);var he=[];function de(e){b(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),de(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=o.JSON.stringify,pe=o.JSON.parse,ge=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function me(){}function ye(e){return e.h||(e.h=e.i())}function ve(){}me.prototype.h=null;var we={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function be(){M.call(this,"d")}function Ie(){M.call(this,"c")}f(be,M),f(Ie,M);var _e={},Ee=null;function Te(){return Ee=Ee||new ie}function Se(e){M.call(this,_e.La,e)}function Ce(e){const t=Te();se(t,new Se(t,e))}function De(e,t){M.call(this,_e.STAT_EVENT,e),this.stat=t}function Ae(e){const t=Te();se(t,new De(t,e))}function xe(e,t){M.call(this,_e.Ma,e),this.size=t}function ke(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function Ne(){this.g=!0}function Oe(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return fe(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}_e.La="serverreachability",f(Se,M),_e.STAT_EVENT="statevent",f(De,M),_e.Ma="timingevent",f(xe,M),Ne.prototype.xa=function(){this.g=!1},Ne.prototype.info=function(){};var Pe,Le={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Me={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Re(){}function Fe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}f(Re,me),Re.prototype.g=function(){return new XMLHttpRequest},Re.prototype.i=function(){return{}},Pe=new Re;var je={},Be={};function Ue(e,t,n){e.L=1,e.v=ft(ct(t)),e.m=n,e.P=!0,qe(e,null)}function qe(e,t){e.F=Date.now(),Ke(e),e.A=ct(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Dt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ve,e.g=gn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ue(h(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(he[0]=i.toString()),i=he);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?I(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ce(1),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function ze(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function $e(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Be:(n=Number(t.substring(n,r)),isNaN(n)?je:(r+=1)+n>t.length?Be:(t=t.slice(r,r+n),e.C=r+n,t))}function Ke(e){e.S=Date.now()+e.I,Ge(e,e.I)}function Ge(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ke(h(e.ba,e),t)}function We(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||ln(e.j,e)}function Qe(e){We(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,de(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Xe(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||tt(n.h,e)))if(!e.K&&tt(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;un(n),Yt(n)}on(n),Ae(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=ke(h(n.Za,n),6e3));if(1>=et(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else dn(n,11)}else if((e.K||n.g==e)&&un(n),!m(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(nt(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,dt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=pn(r,r.J?r.ia:null,r.W),o.K){rt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(We(a),Ke(a)),r.g=o}else sn(r);0<n.i.length&&en(n)}else"stop"!=u[0]&&"close"!=u[0]||dn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?dn(n,7):Jt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Ce(4)}catch(e){}}Fe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Wt(e)?t.j():this.Y(e)},Fe.prototype.Y=function(e){try{if(e==this.g)e:{const d=Wt(this.g);var t=this.g.Ba();const f=this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=d||7==t||Ce(8==t||0>=f?3:2),We(this);var n=this.g.Z();this.X=n;t:if(ze(this)){var r=Ht(this.g);e="";var i=r.length,s=4==Wt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Qe(this),He(this);var a="";break t}this.h.i=new o.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ae(12),Qe(this),He(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xe(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=$e(this,a),e==Be){4==d&&(this.s=4,Ae(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==je){this.s=4,Ae(15),Oe(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),Xe(this,e)}if(ze(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ae(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),an(h),h.M=!0,Ae(11))}}else Oe(this.i,this.l,a,"[Invalid Chunked Response]"),Qe(this),He(this)}else Oe(this.i,this.l,a,null),Xe(this,a);4==d&&Qe(this),this.o&&!this.J&&(4==d?ln(this.j,this):(this.o=!1,Ke(this)))}else(function(e){const t={};e=(e.g&&2<=Wt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(m(e[r]))continue;var n=T(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),Qe(this),He(this)}}}catch(e){}},Fe.prototype.cancel=function(){this.J=!0,Qe(this)},Fe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ce(3),Ae(17)),Qe(this),this.s=2,He(this)):Ge(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Ye(e){this.l=e||10,e=o.PerformanceNavigationTiming?0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ze(e){return!!e.h||!!e.g&&e.g.size>=e.j}function et(e){return e.h?1:e.g?e.g.size:0}function tt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function nt(e,t){e.g?e.g.add(t):e.h=t}function rt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function it(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return p(e.i)}function st(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}Ye.prototype.cancel=function(){if(this.i=it(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ot=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function at(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof at){this.h=e.h,ut(this,e.j),this.o=e.o,this.g=e.g,lt(this,e.s),this.l=e.l;var t=e.i,n=new Et;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ht(this,n),this.m=e.m}else e&&(t=String(e).match(ot))?(this.h=!1,ut(this,t[1]||"",!0),this.o=pt(t[2]||""),this.g=pt(t[3]||"",!0),lt(this,t[4]),this.l=pt(t[5]||"",!0),ht(this,t[6]||"",!0),this.m=pt(t[7]||"")):(this.h=!1,this.i=new Et(null,this.h))}function ct(e){return new at(e)}function ut(e,t,n){e.j=n?pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ht(e,t,n){t instanceof Et?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(St(this,t),Dt(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=gt(t,It)),e.i=new Et(t,e.h))}function dt(e,t,n){e.i.set(t,n)}function ft(e){return dt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function gt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,mt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function mt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}at.prototype.toString=function(){var e=[],t=this.j;t&&e.push(gt(t,vt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(gt(t,vt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(gt(n,"/"==n.charAt(0)?bt:wt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",gt(n,_t)),e.join("")};var yt,vt=/[#\/\?@]/g,wt=/[#\?:]/g,bt=/[#\?]/g,It=/[#\?@]/g,_t=/#/g;function Et(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function St(e,t){Tt(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ct(e,t){return Tt(e),t=At(e,t),e.g.has(t)}function Dt(e,t,n){St(e,t),0<n.length&&(e.i=null,e.g.set(At(e,t),p(n)),e.h+=n.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function xt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function kt(){this.g=new ge}function Nt(e,t,n){const r=n||"";try{st(e,function(e,n){let i=e;c(e)&&(i=fe(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ot(e){this.l=e.Ub||null,this.j=e.eb||!1}function Pt(e,t){ie.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Lt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Rt(e)}function Rt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ft(e){let t="";return b(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Vt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Ft(n),"string"==typeof e?(encodeURIComponent(String(t)),null!=n&&encodeURIComponent(String(n))):dt(e,t,n))}function jt(e){ie.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Et.prototype).add=function(e,t){Tt(this),this.i=null,e=At(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){Tt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},t.V=function(e){Tt(this);let t=[];if("string"==typeof e)Ct(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},t.set=function(e,t){return Tt(this),this.i=null,Ct(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},f(Ot,me),Ot.prototype.g=function(){return new Pt(this.l,this.j)},Ot.prototype.i=(yt={},function(){return yt}),f(Pt,ie),(t=Pt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Rt(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},t.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Rt(this)),this.g&&(this.readyState=3,Rt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mt(this):Rt(this),3==this.readyState&&Lt(this)}},t.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},t.Qa=function(e){this.g&&(this.response=e,Mt(this))},t.ga=function(){this.g&&Mt(this)},t.setRequestHeader=function(e,t){this.u.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Pt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),f(jt,ie);var Bt=/^https?$/i,Ut=["POST","PUT"];function qt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,zt(e),Kt(e)}function zt(e){e.A||(e.A=!0,se(e,"complete"),se(e,"error"))}function $t(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=Wt(e)||2!=e.Z()))if(e.u&&4==Wt(e))ae(e.Ea,0,e);else if(se(e,"readystatechange"),4==Wt(e)){e.h=!1;try{const s=e.Z();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){var i=String(e.D).match(ot)[1]||null;!i&&o.self&&o.self.location&&(i=o.self.location.protocol.slice(0,-1)),r=!Bt.test(i?i.toLowerCase():"")}n=r}if(n)se(e,"complete"),se(e,"success");else{e.m=6;try{var a=2<Wt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",zt(e)}}finally{Kt(e)}}}function Kt(e,t){if(e.g){Gt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||se(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Gt(e){e.I&&(o.clearTimeout(e.I),e.I=null)}function Wt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Qt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Xt(e){this.Aa=0,this.i=[],this.j=new Ne,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qt("baseRetryDelayMs",5e3,e),this.cb=Qt("retryDelaySeedMs",1e4,e),this.Wa=Qt("forwardChannelMaxRetries",2,e),this.wa=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ye(e&&e.concurrentRequestLimit),this.Da=new kt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Zt(e),3==e.G){var t=e.U++,n=ct(e.I);if(dt(n,"SID",e.K),dt(n,"RID",t),dt(n,"TYPE","terminate"),nn(e,n),(t=new Fe(e,e.j,t)).L=2,t.v=ft(ct(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=gn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ke(t)}fn(e)}function Yt(e){e.g&&(an(e),e.g.cancel(),e.g=null)}function Zt(e){Yt(e),e.u&&(o.clearTimeout(e.u),e.u=null),un(e),e.h.cancel(),e.s&&("number"==typeof e.s&&o.clearTimeout(e.s),e.s=null)}function en(e){if(!Ze(e.h)&&!e.s){e.s=!0;var t=e.Ga;x||O(),k||(x(),k=!0),N.add(t,e),e.B=0}}function tn(e,t){var n;n=t?t.l:e.U++;const r=ct(e.I);dt(r,"SID",e.K),dt(r,"RID",n),dt(r,"AID",e.T),nn(e,r),e.m&&e.o&&Vt(r,e.m,e.o),n=new Fe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=rn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),nt(e.h,n),Ue(n,r,t)}function nn(e,t){e.H&&b(e.H,function(e,n){dt(t,n,e)}),e.l&&st({},function(e,n){dt(t,n,e)})}function rn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?h(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Nt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function sn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;x||O(),k||(x(),k=!0),N.add(t,e),e.v=0}}function on(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=ke(h(e.Fa,e),hn(e,e.v)),e.v++,0))}function an(e){null!=e.A&&(o.clearTimeout(e.A),e.A=null)}function cn(e){e.g=new Fe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ct(e.qa);dt(t,"RID","rpc"),dt(t,"SID",e.K),dt(t,"AID",e.T),dt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&dt(t,"TO",e.ja),dt(t,"TYPE","xmlhttp"),nn(e,t),e.m&&e.o&&Vt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ft(ct(t)),n.m=null,n.P=!0,qe(n,e)}function un(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){un(e),an(e),e.g=null;var r=2}else{if(!tt(e.h,t))return;n=t.D,rt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;se(r=Te(),new xe(r,n,t,i)),en(e)}else sn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(et(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=ke(h(e.Ga,e,t),hn(e,e.B)),e.B++,0)))}(e,t)||2==r&&on(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:dn(e,5);break;case 4:dn(e,10);break;case 3:dn(e,6);break;default:dn(e,2)}}function hn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function dn(e,t){if(e.j.info("Error code "+t),2==t){var n=h(e.fb,e),r=e.Xa;const t=!r;r=new at(r||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||ut(r,"https"),ft(r),t?function(e,t){const n=new Ne;if(o.Image){const r=new Image;r.onload=d(xt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=d(xt,n,"TestLoadImage: error",!1,t,r),r.onabort=d(xt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=d(xt,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ne;const n=new AbortController,r=setTimeout(()=>{n.abort(),xt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?xt(0,0,!0,t):xt(0,0,!1,t)}).catch(()=>{clearTimeout(r),xt(0,0,!1,t)})}(r.toString(),n)}else Ae(2);e.G=0,e.l&&e.l.sa(t),fn(e),Zt(e)}function fn(e){if(e.G=0,e.ka=[],e.l){const t=it(e.h);0==t.length&&0==e.i.length||(g(e.ka,t),g(e.ka,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.ra()}}function pn(e,t,n){var r=n instanceof at?ct(n):new at(n);if(""!=r.g)t&&(r.g=t+"."+r.g),lt(r,r.s);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new at(null);r&&ut(s,r),t&&(s.g=t),i&&lt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&dt(r,n,t),dt(r,"VER",e.la),nn(e,r),r}function gn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new jt(new Ot({eb:n})):new jt(e.pa)).Ha(e.J),t}function mn(){}function yn(){}function vn(e,t){ie.call(this),this.g=new Xt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new In(this)}function wn(e){be.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function bn(){Ie.call(this),this.status=1}function In(e){this.g=e}(t=jt.prototype).Ha=function(e){this.J=e},t.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pe.g(),this.v=this.o?ye(this.o):ye(Pe),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void qt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=o.FormData&&e instanceof o.FormData,!(0<=Array.prototype.indexOf.call(Ut,t,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){qt(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,se(this,"complete"),se(this,"abort"),Kt(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kt(this,!0)),jt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?$t(this):this.bb())},t.bb=function(){$t(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<Wt(this)?this.g.status:-1}catch(e){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),pe(t)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Xt.prototype).la=8,t.G=1,t.connect=function(e,t,n,r){Ae(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=pn(this,null,this.W),en(this)},t.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Fe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=I(s),E(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=rn(this,i,t),dt(n=ct(this.I),"RID",e),dt(n,"CVER",22),this.D&&dt(n,"X-HTTP-Session-Id",this.D),nn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Ft(s)))+"&"+t:this.m&&Vt(n,this.m,s)),nt(this.h,i),this.Ua&&dt(n,"TYPE","init"),this.P?(dt(n,"$req",t),dt(n,"SID","null"),i.T=!0,Ue(i,n,null)):Ue(i,n,t),this.G=2}}else 3==this.G&&(e?tn(this,e):0==this.i.length||Ze(this.h)||tn(this))},t.Fa=function(){if(this.u=null,cn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ke(h(this.ab,this),e)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Yt(this),cn(this))},t.Za=function(){null!=this.C&&(this.C=null,Yt(this),on(this),Ae(19))},t.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=mn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},yn.prototype.g=function(e,t){return new vn(e,t)},f(vn,ie),vn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vn.prototype.close=function(){Jt(this.g)},vn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=fe(e),e=n);t.i.push(new Je(t.Ya++,e)),3==t.G&&en(t)},vn.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,vn.aa.N.call(this)},f(wn,be),f(bn,Ie),f(In,mn),In.prototype.ua=function(){se(this.g,"a")},In.prototype.ta=function(e){se(this.g,new wn(e))},In.prototype.sa=function(e){se(this.g,new bn(e))},In.prototype.ra=function(){se(this.g,"b")},yn.prototype.createWebChannel=yn.prototype.g,vn.prototype.send=vn.prototype.o,vn.prototype.open=vn.prototype.m,vn.prototype.close=vn.prototype.close,e.exports.createWebChannelTransport=function(){return new yn},e.exports.getStatEventTarget=function(){return Te()},e.exports.Event=_e,e.exports.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Le.NO_ERROR=0,Le.TIMEOUT=8,Le.HTTP_ERROR=6,e.exports.ErrorCode=Le,Me.COMPLETE="complete",e.exports.EventType=Me,ve.EventType=we,we.OPEN="a",we.CLOSE="b",we.ERROR="c",we.MESSAGE="d",ie.prototype.listen=ie.prototype.K,e.exports.WebChannel=ve,e.exports.FetchXmlHttpFactory=Ot,jt.prototype.listenOnce=jt.prototype.L,jt.prototype.getLastError=jt.prototype.Ka,jt.prototype.getLastErrorCode=jt.prototype.Ba,jt.prototype.getStatus=jt.prototype.Z,jt.prototype.getResponseJson=jt.prototype.Oa,jt.prototype.getResponseText=jt.prototype.oa,jt.prototype.send=jt.prototype.ea,jt.prototype.setWithCredentials=jt.prototype.Ha,e.exports.XhrIo=jt}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},844:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=[];var r;t.LogLevel=void 0,(r=t.LogLevel||(t.LogLevel={}))[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";const i={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},s=t.LogLevel.INFO,o={[t.LogLevel.DEBUG]:"log",[t.LogLevel.VERBOSE]:"log",[t.LogLevel.INFO]:"info",[t.LogLevel.WARN]:"warn",[t.LogLevel.ERROR]:"error"},a=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=o[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};t.Logger=class{constructor(e){this.name=e,this._logLevel=s,this._logHandler=a,this._userLogHandler=null,n.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in t.LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.DEBUG,...e),this._logHandler(this,t.LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.VERBOSE,...e),this._logHandler(this,t.LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.INFO,...e),this._logHandler(this,t.LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.WARN,...e),this._logHandler(this,t.LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.ERROR,...e),this._logHandler(this,t.LogLevel.ERROR,...e)}},t.setLogLevel=function(e){n.forEach(t=>{t.setLogLevel(e)})},t.setUserLogHandler=function(e,r){for(const s of n){let n=null;r&&r.level&&(n=i[r.level]),s.userLogHandler=null===e?null:(r,i,...s)=>{const o=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");i>=(null!=n?n:r.logLevel)&&e({level:t.LogLevel[i].toLowerCase(),message:o,args:s,type:r.name})}}}},860:(e,t,n)=>{(function(){"use strict";var t;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(n,function(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},n.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s={};function o(e){return-128<=e&&128>e?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],0>e?-1:0)}(e)}(e):new i([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return f(a(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var c=o(0),u=o(1),l=o(16777216);function h(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function f(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function p(e,t){return e.add(f(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function y(e,t){if(h(t))throw Error("division by zero");if(h(e))return new m(c,c);if(d(e))return t=y(f(e),t),new m(f(t.g),f(t.h));if(d(t))return t=y(e,f(t)),new m(f(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!h(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=w(r,1),n=w(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=a(n)).j(t);d(o)||0<o.l(e);)o=(s=a(n-=r)).j(t);h(s)&&(s=u),i=i.add(s),e=p(e,o)}return new m(i,e)}function v(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(s,e.h)}(t=i.prototype).m=function(){if(d(this))return-f(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},t.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(d(this))return"-"+f(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,r="";;){var i=y(n,t).g,s=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(h(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},t.l=function(e){return d(e=p(this,e))?-1:h(e)?0:1},t.abs=function(){return d(this)?f(this):this},t.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new i(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(e){if(h(this)||h(e))return c;if(d(this))return d(e)?f(this).j(f(e)):f(f(this).j(e));if(d(e))return f(this.j(f(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var o=this.i(r)>>>16,u=65535&this.i(r),p=e.i(s)>>>16,m=65535&e.i(s);n[2*r+2*s]+=u*m,g(n,2*r+2*s),n[2*r+2*s+1]+=o*m,g(n,2*r+2*s+1),n[2*r+2*s+1]+=u*p,g(n,2*r+2*s+1),n[2*r+2*s+2]+=o*p,g(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},t.A=function(e){return y(this,e).h},t.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},t.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},t.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,e.exports.Md5=n,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=a,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=a(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+o),n);8>o?(o=a(Math.pow(n,o)),i=i.j(o).add(a(u))):i=(i=i.j(r)).add(a(u))}return i},e.exports.Integer=i}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},873:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultsFromPostinstall=()=>{}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(73);WebPushInit=r})();